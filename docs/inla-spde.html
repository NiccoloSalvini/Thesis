<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 INLA computation | REST API for Real Estate rental data, a spatial bayesian modeling approach with INLA.</title>
  <meta name="description" content="Niccolò Salvini master’s thesis project" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 INLA computation | REST API for Real Estate rental data, a spatial bayesian modeling approach with INLA." />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://niccolosalvini.github.io/Thesis/" />
  <meta property="og:image" content="https://niccolosalvini.github.io/Thesis/images/spat-touch.png" />
  <meta property="og:description" content="Niccolò Salvini master’s thesis project" />
  <meta name="github-repo" content="NiccoloSalvini/Thesis" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 INLA computation | REST API for Real Estate rental data, a spatial bayesian modeling approach with INLA." />
  
  <meta name="twitter:description" content="Niccolò Salvini master’s thesis project" />
  <meta name="twitter:image" content="https://niccolosalvini.github.io/Thesis/images/spat-touch.png" />

<meta name="author" content="Niccolò Salvini" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="images/spatial.png" />
  <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
<link rel="prev" href="exploratory.html"/>
<link rel="next" href="prdm.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-171723874-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-171723874-1');
</script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"> REST API for Real Estate rental data, a spatial bayesian modeling approach with INLA.</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="scraping.html"><a href="scraping.html"><i class="fa fa-check"></i><b>2</b> Scraping</a><ul>
<li class="chapter" data-level="2.1" data-path="scraping.html"><a href="scraping.html#what-is-web-scraping"><i class="fa fa-check"></i><b>2.1</b> What is Web Scraping</a><ul>
<li class="chapter" data-level="2.1.1" data-path="scraping.html"><a href="scraping.html#webstructure"><i class="fa fa-check"></i><b>2.1.1</b> Immobiliare.it Webscraping website structure</a></li>
<li class="chapter" data-level="2.1.2" data-path="scraping.html"><a href="scraping.html#immobiliare.it-webscraping-content-architecture-with-rvest"><i class="fa fa-check"></i><b>2.1.2</b> Immobiliare.it Webscraping content architecture with <code>rvest</code></a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="scraping.html"><a href="scraping.html#best-practices"><i class="fa fa-check"></i><b>2.2</b> Scraping Best Practices and Robottxt</a></li>
<li class="chapter" data-level="2.3" data-path="scraping.html"><a href="scraping.html#user-agents-proxies-handlers"><i class="fa fa-check"></i><b>2.3</b> User agents, Proxies, Handlers</a><ul>
<li class="chapter" data-level="2.3.1" data-path="scraping.html"><a href="scraping.html#spoofing"><i class="fa fa-check"></i><b>2.3.1</b> User agents Spoofing</a></li>
<li class="chapter" data-level="2.3.2" data-path="scraping.html"><a href="scraping.html#handlers"><i class="fa fa-check"></i><b>2.3.2</b> Handlers</a></li>
<li class="chapter" data-level="2.3.3" data-path="scraping.html"><a href="scraping.html#parallel-computing"><i class="fa fa-check"></i><b>2.3.3</b> Parallel Computing</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="scraping.html"><a href="scraping.html#challenges"><i class="fa fa-check"></i><b>2.4</b> Further Improvements</a></li>
<li class="chapter" data-level="2.5" data-path="scraping.html"><a href="scraping.html#legal-challenges-ancora-non-validato"><i class="fa fa-check"></i><b>2.5</b> Legal Challenges (ancora non validato)</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="Infrastructure.html"><a href="Infrastructure.html"><i class="fa fa-check"></i><b>3</b> Infrastructure</a><ul>
<li class="chapter" data-level="3.1" data-path="Infrastructure.html"><a href="Infrastructure.html#scheduler"><i class="fa fa-check"></i><b>3.1</b> Scheduler</a><ul>
<li class="chapter" data-level="3.1.1" data-path="Infrastructure.html"><a href="Infrastructure.html#cron-jobs"><i class="fa fa-check"></i><b>3.1.1</b> Cron Jobs</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="Infrastructure.html"><a href="Infrastructure.html#docker"><i class="fa fa-check"></i><b>3.2</b> Docker</a><ul>
<li class="chapter" data-level="3.2.1" data-path="Infrastructure.html"><a href="Infrastructure.html#what-is-docker"><i class="fa fa-check"></i><b>3.2.1</b> What is Docker</a></li>
<li class="chapter" data-level="3.2.2" data-path="Infrastructure.html"><a href="Infrastructure.html#why-docker"><i class="fa fa-check"></i><b>3.2.2</b> Why Docker</a></li>
<li class="chapter" data-level="3.2.3" data-path="Infrastructure.html"><a href="Infrastructure.html#dockerfile"><i class="fa fa-check"></i><b>3.2.3</b> Dockerfile</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="Infrastructure.html"><a href="Infrastructure.html#api"><i class="fa fa-check"></i><b>3.3</b> API</a><ul>
<li class="chapter" data-level="3.3.1" data-path="Infrastructure.html"><a href="Infrastructure.html#plumberapi"><i class="fa fa-check"></i><b>3.3.1</b> Plumber API</a></li>
<li class="chapter" data-level="3.3.2" data-path="Infrastructure.html"><a href="Infrastructure.html#immobiliare.it-http-api"><i class="fa fa-check"></i><b>3.3.2</b> Immobiliare.it HTTP API</a></li>
<li class="chapter" data-level="3.3.3" data-path="Infrastructure.html"><a href="Infrastructure.html#api-source-code"><i class="fa fa-check"></i><b>3.3.3</b> API source code</a></li>
<li class="chapter" data-level="3.3.4" data-path="Infrastructure.html"><a href="Infrastructure.html#api-documentation"><i class="fa fa-check"></i><b>3.3.4</b> API documentation</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="Infrastructure.html"><a href="Infrastructure.html#nginx"><i class="fa fa-check"></i><b>3.4</b> NGINX reverse proxy server</a></li>
<li class="chapter" data-level="3.5" data-path="Infrastructure.html"><a href="Infrastructure.html#aws"><i class="fa fa-check"></i><b>3.5</b> AWS EC2 server</a><ul>
<li class="chapter" data-level="3.5.1" data-path="Infrastructure.html"><a href="Infrastructure.html#launch-an-ec2-instance"><i class="fa fa-check"></i><b>3.5.1</b> Launch an EC2 instance</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="exploratory.html"><a href="exploratory.html"><i class="fa fa-check"></i><b>4</b> Exploratory Analysis</a><ul>
<li class="chapter" data-level="4.1" data-path="exploratory.html"><a href="exploratory.html#what-data-is"><i class="fa fa-check"></i><b>4.1</b> What data is</a></li>
<li class="chapter" data-level="4.2" data-path="exploratory.html"><a href="exploratory.html#data-glimpse"><i class="fa fa-check"></i><b>4.2</b> Data Glimpse</a></li>
<li class="chapter" data-level="4.3" data-path="exploratory.html"><a href="exploratory.html#explorative-analysis"><i class="fa fa-check"></i><b>4.3</b> Explorative Analysis</a><ul>
<li class="chapter" data-level="4.3.1" data-path="exploratory.html"><a href="exploratory.html#semivariogram-covariogram"><i class="fa fa-check"></i><b>4.3.1</b> Semivariogram Covariogram</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="inla-spde.html"><a href="inla-spde.html"><i class="fa fa-check"></i><b>5</b> INLA computation</a><ul>
<li class="chapter" data-level="5.1" data-path="inla-spde.html"><a href="inla-spde.html#LGM"><i class="fa fa-check"></i><b>5.1</b> Latent Gaussian Models LGM</a></li>
<li class="chapter" data-level="5.2" data-path="inla-spde.html"><a href="inla-spde.html#approximation-in-inla-setting"><i class="fa fa-check"></i><b>5.2</b> Approximation in INLA setting</a><ul>
<li class="chapter" data-level="5.2.1" data-path="inla-spde.html"><a href="inla-spde.html#further-methods-for-approximations-prolly-do-not-note-include"><i class="fa fa-check"></i><b>5.2.1</b> further methods for approximations (prolly do not note include)</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="inla-spde.html"><a href="inla-spde.html#r-inla-package-in-a-bayesian-perspective"><i class="fa fa-check"></i><b>5.3</b> R-INLA package in a bayesian perspective</a><ul>
<li class="chapter" data-level="5.3.1" data-path="inla-spde.html"><a href="inla-spde.html#linear-predictor"><i class="fa fa-check"></i><b>5.3.1</b> Linear Predictor</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="prdm.html"><a href="prdm.html"><i class="fa fa-check"></i><b>6</b> Point Referenced Data Modeling</a><ul>
<li class="chapter" data-level="6.1" data-path="prdm.html"><a href="prdm.html#GP"><i class="fa fa-check"></i><b>6.1</b> Gaussian Process (GP)</a><ul>
<li class="chapter" data-level="6.1.1" data-path="prdm.html"><a href="prdm.html#Matern"><i class="fa fa-check"></i><b>6.1.1</b> Matérn covariance function</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="prdm.html"><a href="prdm.html#hedonic-price-models-for-rental-house-market"><i class="fa fa-check"></i><b>6.2</b> Hedonic Price Models for Rental House Market</a></li>
<li class="chapter" data-level="6.3" data-path="prdm.html"><a href="prdm.html#regression-for-univariate-spatial-data"><i class="fa fa-check"></i><b>6.3</b> Regression for univariate spatial data</a><ul>
<li class="chapter" data-level="6.3.1" data-path="prdm.html"><a href="prdm.html#parameter-estimation"><i class="fa fa-check"></i><b>6.3.1</b> Parameter estimation</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="prdm.html"><a href="prdm.html#hierreg"><i class="fa fa-check"></i><b>6.4</b> Hierarchical Bayesian Regression</a></li>
<li class="chapter" data-level="6.5" data-path="prdm.html"><a href="prdm.html#inla-as-a-hierarchical-model-va-parafrasato"><i class="fa fa-check"></i><b>6.5</b> INLA as a hierarchical model [va parafrasato]</a></li>
<li class="chapter" data-level="6.6" data-path="prdm.html"><a href="prdm.html#spatial-kriging"><i class="fa fa-check"></i><b>6.6</b> Spatial Kriging</a></li>
<li class="chapter" data-level="6.7" data-path="prdm.html"><a href="prdm.html#model-checking-and-comparison"><i class="fa fa-check"></i><b>6.7</b> Model Checking and Comparison</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="spde.html"><a href="spde.html"><i class="fa fa-check"></i><b>7</b> SPDE approach</a></li>
<li class="chapter" data-level="8" data-path="application.html"><a href="application.html"><i class="fa fa-check"></i><b>8</b> Shiny Web App</a><ul>
<li class="chapter" data-level="8.1" data-path="application.html"><a href="application.html#example-one"><i class="fa fa-check"></i><b>8.1</b> Example one</a></li>
<li class="chapter" data-level="8.2" data-path="application.html"><a href="application.html#example-two"><i class="fa fa-check"></i><b>8.2</b> Example two</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="final-words.html"><a href="final-words.html"><i class="fa fa-check"></i><b>9</b> Final Words</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/NiccoloSalvini/tesi-prova" target="blank"> See Github Repository</a></li>
<li><a href="https://niccolosalvini.netlify.app/">About The Author</a></li>
<li><a Proudly published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">REST API for Real Estate rental data, a spatial bayesian modeling approach with INLA.</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="inla-spde" class="section level1">
<h1><span class="header-section-number">Chapter 5</span> INLA computation</h1>
<p>INLA <span class="citation">(Rue, Martino, and Chopin <a href="#ref-Rue2009" role="doc-biblioref">2009</a>)</span> stands for Integrated Nested Laplace approximation and constitutes a integral computational alternative to traditional MCMC methods. INLA does approximate bayesian inference on special type of models called LGM (Latent Gaussian Models) due to the fact that they are <em>computationally</em> convenient. The benefits are many, some among the other are:</p>
<ul>
<li>Low computational costs, even for large models.</li>
<li>It provides high accuracy.</li>
<li>Can define very complex models within that framework.</li>
<li>Most important statistical models are LGM.</li>
<li>Very good support for spatial models.</li>
<li>Implementatio of spatio-temporal model enabled.</li>
</ul>
<p>INLA uses a combination of analytics approximations and numerical integration to obtain an approximated posterior distribution of the parameters in a shorter time period.
The combination of INLA and SPDE (Stochastic Partial Differential Equations) allows to analyze point level data at a faster pace, SPDE is approached in chapter <a href="spde.html#spde">7</a>. Notation is imported from <span class="citation">Marta Blangiardo (<a href="#ref-Blangiardo-Cameletti" role="doc-biblioref">2015</a>)</span> and <span class="citation">Gómez Rubio (<a href="#ref-Bayesian_INLA_Rubio" role="doc-biblioref">2020</a>)</span>, and quite differ from the one in the original paper by Rue, Chopin and Martino <span class="citation">(<a href="#ref-Rue2009" role="doc-biblioref">2009</a>)</span>. The chrono-logic steps in the methodology presentation follows <span class="citation">Moraga (<a href="#ref-Moraga2019" role="doc-biblioref">2019</a>)</span> and author choices. As a notation remark, bold symbols are considered as vectors, so each time they occur they have to be considered like the <em>ensamble</em> of their values.</p>
<div id="LGM" class="section level2">
<h2><span class="header-section-number">5.1</span> Latent Gaussian Models LGM</h2>
<p>INLA can fit only LG type of models so the following work tries to encapsulate the main properties of a LGM, so that a problem can be shaped into the LGM framework with the purpose to exploit its benefits. Given some observations <span class="math inline">\(y_{i \ldots n}\)</span> in order to define a Latent Gaussain Model within the bayesian framework it is convenient to specify at first an <em>exponential family</em> (Gaussian, Poisson, Exponential…) distribution function characterized by some parameters <span class="math inline">\(\phi_{i}\)</span> (usually expressed by the mean <span class="math inline">\(\left.E\left(y_{i}\right)\right)\)</span>) and some other hyper-parameters <span class="math inline">\(\psi_{k} ,\forall k \in \ 1\ldots K\)</span>. The parameter <span class="math inline">\(\phi_{i}\)</span> can be defined as an additive <em>latent linear predictor</em> <span class="math inline">\(\eta_{i}\)</span>, as pointed out by Krainski and Rubio (<span class="citation">(<a href="#ref-Krainski-Rubio" role="doc-biblioref">2019</a>)</span>) through a link function <span class="math inline">\(g(\cdot)\)</span>, i.e. <span class="math inline">\(g\left(\phi_{i}\right)=\eta_{i}\)</span>. A comprehensive expression of the linear predictor takes into account all the possible effects on covariates</p>
<p><span class="math display">\[
\eta_{i}=\beta_{0}+\sum_{m=1}^{M} \beta_{m} x_{m i}+\sum_{l=1}^{L} f_{l}\left(z_{l i}\right)
\]</span></p>
<p>where <span class="math inline">\(\beta_{0}\)</span> is the intercept, <span class="math inline">\(\boldsymbol{\beta}=\left\{\beta_{1}, \ldots, \beta_{M}\right\}\)</span> are the coefficient that quantifies the linear effects on covariates <span class="math inline">\(\boldsymbol{x}=\left({x}_{1}, \ldots, {x}_{M}\right)\)</span> and <span class="math inline">\(f_{l}(\cdot), \forall l \in 1 \ldots L\)</span> are a set of random effects defined in terms of a set of covariates <span class="math inline">\(\boldsymbol{z}=\left(z_{1}, \ldots, z_{L}\right)\)</span> (e.g. rw, ar1). Because of the last assumption LGM models can receive a wide range of models e.g. GLM, GAM, GLMM, linear models and spatio-temporal models.
All the latent components can be conveniently grouped into a variable denoted with <span class="math inline">\(\boldsymbol{\theta}\)</span> such that: <span class="math inline">\(\boldsymbol{\theta}=\left\{\beta_{0}, \beta, f\right\}\)</span> and the same can de done for hyper parameters <span class="math inline">\(\boldsymbol{\psi} = \left\{\psi_{1}, \ldots, \psi_{K}\right\}\)</span>.
Then the probability distribution conditioned to parameters and hyper parameters is then:</p>
<p><span class="math display">\[y_{i} \mid \boldsymbol{\theta}, \boldsymbol{\psi} \sim \pi\left(y_{i} \mid \boldsymbol{\theta},\boldsymbol{\psi}\right)\]</span></p>
<p>Since data <span class="math inline">\(\left(y_{1}, \ldots, y_{n}\right)\)</span> is drawn by the same distribution family but it is conditioned to parameters and hyper parameters (i.e. conditional independence) then joint distribution is given by the likelihood. The Product operator index <span class="math inline">\(i\)</span> goes from 1 to <span class="math inline">\(n\)</span>, i.e. <span class="math inline">\(\mathbf{I} = \left\{1 \ldots n \right\}\)</span>. When a is missing so the correspoding i is not in <span class="math inline">\(\mathbf{I}\)</span> INLA authomatically will not include the index in the model avoiding errors. <span class="citation">(<a href="#ref-Bayesian_INLA_Rubio" role="doc-biblioref">2020</a>)</span>. As a consequence the likelihood expression is:</p>
<p><span class="math display">\[\pi(\boldsymbol{y} \mid \boldsymbol{\theta}, \boldsymbol{\psi})=\prod_{i \in \mathbf{I}} \pi\left(y_{i} \mid \theta_{i}, \boldsymbol{\psi}\right)\]</span></p>
<p>Each data point is connected to a linear combination of each element in <span class="math inline">\(\boldsymbol{\theta}\)</span> said <em>latent field</em>. Each component of the latent field is supposed to be conditionally independent (i.e. <span class="math inline">\(p\left(\theta_{i}, \theta_{j} \mid \theta_{-i, j}\right)=p\left(\theta_{i} \mid \theta_{-i, j}\right) p\left(\theta_{j} \mid \theta_{-i, j}\right)\)</span>) which constitutes a very important assumption. Hyper parameters are by definition independent, therefore <span class="math inline">\(\boldsymbol{\psi}\)</span> will be the product of many univariate priors <span class="citation">(<a href="#ref-Bayesian_INLA_Rubio" role="doc-biblioref">2020</a>)</span>. A Multivariate Normal distribution is imposed on the latent field <span class="math inline">\(\boldsymbol{\theta}\)</span> such that it is centered in 0 with precision matrix <span class="math inline">\(\boldsymbol{Q(\psi)}\)</span> depending on <span class="math inline">\(\boldsymbol{\psi}\)</span> hyper parameter vector i.e., <span class="math inline">\(\boldsymbol{\theta} \sim \operatorname{Normal}\left(\mathbf{0}, \boldsymbol{Q}^{-1}(\boldsymbol{\psi})\right)\)</span>. As side note some authors choose to approach the precision matrix as a covariance function in the setting before. This is strongly not encouraged since it complicates notation. However This has to be forcibly done in next chapter since a special covariance function is used.
The exponential family density function is then expressed through:</p>
<p><span class="math display">\[
\pi(\theta \mid \psi)=(2 \pi)^{-n / 2}|Q(\psi)|^{1 / 2} \exp \left(-\frac{1}{2} \theta^{\prime} Q(\psi) \theta\right)
\]</span></p>
<p>The conditional independence assumption on the latent field <span class="math inline">\(\boldsymbol{\theta}\)</span> leads <span class="math inline">\(\boldsymbol{Q(\psi)}\)</span> to be a sparse precision matrix, and the probability distribution function takes the name of <em>Gaussian Markov random field</em> (<strong>GMRF</strong>). From here comes the computational power inherited using GMRF for inference, matrices are sparse so numerical methods can be exploited <span class="citation">(Marta Blangiardo <a href="#ref-Blangiardo-Cameletti" role="doc-biblioref">2015</a>)</span>. This last assumptio will be discussed and verifies in capter <a href="spde.html#spde">7</a>.
Once priors are specified for <span class="math inline">\(\boldsymbol{\psi}\)</span> then the following holds:</p>
<p><span class="math display">\[
\pi(\boldsymbol{\theta}, \boldsymbol{\psi} \mid y)\propto  \underbrace{\pi(\boldsymbol{\psi})}_{\text {prior }} \times \underbrace{\pi(\theta \mid \psi)}_{\text {GMRF }} \times \underbrace{\prod_{i=1}^{n} \pi\left(y_{i} \mid \theta_{i}, \boldsymbol{\psi}\right)}_{\text {likelihood }}
\]</span>
Last expression is said a <strong>LGM</strong> if the whole set of assumption imposed since now are met.
At this point it is possible to write the joint posterior distribution plugging in the corresponding <em>likelihood</em> and <em>GMRF</em> expression:</p>
<p><span class="math display">\[
\begin{aligned}
\pi(\boldsymbol{\theta}, \boldsymbol{\psi} \mid y) &amp; \propto \pi(\boldsymbol{\psi}) \times \pi(\boldsymbol{\theta} \mid \boldsymbol{\psi}) \times \pi(y \mid \boldsymbol{\theta}, \boldsymbol{\psi}) \\
&amp; \propto \pi(\boldsymbol{\psi}) \times \pi(\boldsymbol{\theta} \mid \boldsymbol{\psi}) \times \prod_{i=1}^{n} \pi\left(y_{i} \mid \theta_{i}, \boldsymbol{\psi}\right) \\
&amp; \propto \pi(\boldsymbol{\psi}) \times|\boldsymbol{Q}(\boldsymbol{\psi})|^{1 / 2} \exp \left(-\frac{1}{2} \boldsymbol{\theta}^{\prime} \boldsymbol{Q}(\boldsymbol{\psi}) \boldsymbol{\theta}\right) \times \prod_{i}^{n} \exp \left(\log \left(\pi\left(y_{i} \mid \theta_{i}, \boldsymbol{\psi}\right)\right)\right)
\end{aligned}
\]</span></p>
<p>Joining the exponentials because of their multiplicative property:</p>
<p><span class="math display" id="eq:jointpostdistr">\[\begin{equation}
\pi(\boldsymbol{\theta}, \boldsymbol{\psi} \mid y) \propto \pi(\psi) \times|\boldsymbol{Q}(\boldsymbol{\psi})|^{1 / 2} \exp \left(-\frac{1}{2} \boldsymbol{\theta}^{\prime} \boldsymbol{Q}(\boldsymbol{\psi}) \boldsymbol{\theta}+\sum^{n} \log \left(\pi\left(y_{i} \mid \theta_{i}, \boldsymbol{\psi}\right)\right)\right)
\tag{5.1}
\end{equation}\]</span></p>
</div>
<div id="approximation-in-inla-setting" class="section level2">
<h2><span class="header-section-number">5.2</span> Approximation in INLA setting</h2>
<p>INLA is not going to try to estimate the whole posterior distribution from expression <a href="inla-spde.html#eq:jointpostdistr">(5.1)</a>. Instead it will try to estimate the posterior marginal distribution effects for each latent parameter <span class="math inline">\(\boldsymbol{\theta}\)</span> in the hyper parameter space <span class="math inline">\(\psi_{k}\)</span>. Proper estimation methods however are beyond the scope of the analysis, further references are suggested in their respective part <span class="citation">(<a href="#ref-Bayesian_INLA_Rubio" role="doc-biblioref">2020</a>)</span> in section 2.2.2 and <span class="citation">(<a href="#ref-Blangiardo-Cameletti" role="doc-biblioref">2015</a>)</span> in section 4.7.2. For latent parameter <span class="math inline">\(\boldsymbol{\theta}\)</span> :</p>
<p><span class="math display" id="eq:latentparam">\[\begin{equation}
  \pi(\boldsymbol{\theta} \mid \boldsymbol{y})=\int \pi(\boldsymbol{\theta}, \boldsymbol{\psi} \mid \mathbf{y}) \pi(\boldsymbol{\psi} \mid \mathbf{y}) d \psi
\tag{5.2}
\end{equation}\]</span></p>
<p>The posterior marginal for the hyper parameter is <span class="math inline">\(\boldsymbol{\psi}\)</span> since it is composed by <span class="math inline">\(k\)</span> elements, i.e. <span class="math inline">\(\boldsymbol{\psi}=\left\{\psi_{1}, \ldots, \psi_{K}\right\}\)</span> is:</p>
<p><span class="math display">\[
\pi\left(\psi_{k} \mid y\right)=\int \pi(\boldsymbol{\psi} \mid y) d \psi_{-k}
\]</span></p>
<p>where <span class="math inline">\(\psi_{-k}\)</span> is a vector of hyper parameters <span class="math inline">\(\psi\)</span> without the element <span class="math inline">\(\psi_{k}\)</span>.</p>
<p>Since hyperparam integrals are nested inside the parameter integrals a <em>hierarchical structure</em> can be imposed. This structure is welcomed very warmly since it is convenient later for hierarchical bayesian regression (next chapter <a href="prdm.html#hierreg">6.4</a>).
By unnesting the hierarchical:</p>
<ol style="list-style-type: decimal">
<li>compute the Laplace approximation marginals for the hyper parameters: <span class="math inline">\(\tilde\pi\left(\psi_{k} \mid \boldsymbol{y}\right)\)</span></li>
<li>compute the Laplace approximation marginals for the parameters given the hyper parameter approximation: <span class="math inline">\(\tilde{\pi}\left(\theta_{i} \mid \boldsymbol{y}\right) \approx \int \tilde{\pi}\left(\theta_{i} \mid \boldsymbol{\psi}, \boldsymbol{y}\right) \underbrace{\tilde{\pi}(\boldsymbol{\psi} \mid \boldsymbol{y})}_{\text {Estim. in step 1 }} \mathrm{d} \psi\)</span></li>
</ol>
<p>Then plugging approximation in the integral observed in <a href="inla-spde.html#eq:latentparam">(5.2)</a> it is obtained:</p>
<p><span class="math display">\[
\tilde{\pi}\left(\theta_{i} \mid y\right) \approx \int \tilde{\pi}\left(\theta_{i} \mid  \boldsymbol{\psi}, y\right) \tilde{\pi}(\boldsymbol{\psi} \mid y) \mathrm{d} \psi
\]</span></p>
<p>At this point INLA uses the following approximation to compute marginals:</p>
<p><span class="math display">\[
\tilde{\pi}\left(\theta_{i} \mid y\right) \approx \sum_{j} \tilde{\pi}\left(\theta_{i} \mid \boldsymbol{\psi}^{(j)}, y\right) \tilde{\pi}\left(\boldsymbol{\psi}^{(j)} \mid y\right) \Delta_{j}
\]</span></p>
<p>{<span class="math inline">\(\boldsymbol{\psi}^{(j)}\)</span>} are a set of values of the hyper param <span class="math inline">\(\psi\)</span> grid used for numerical integration, each one associated to a specific weight <span class="math inline">\(\Delta_{j}\)</span>. INLA catch this specific integration points by setting up a regular grid about the posterior mode of <span class="math inline">\(\psi\)</span> with CCD (central composite design) centered in the mode.</p>
<div class="figure">
<img src="images/CCDapplied.PNG" alt="" />
<p class="caption">Blangiardo-Cameletti source</p>
</div>
<p>The approximation <span class="math inline">\(\tilde{\pi}\left(\theta_{i} \mid y\right)\)</span> can take different forms and be computed in different ways. <span class="citation">Rue, Martino, and Chopin (<a href="#ref-Rue2009" role="doc-biblioref">2009</a>)</span> also discuss how this approximation should be in order to reduce the numerical error.</p>
<div id="further-methods-for-approximations-prolly-do-not-note-include" class="section level3">
<h3><span class="header-section-number">5.2.1</span> further methods for approximations (prolly do not note include)</h3>
<p>Following <span class="citation">Gómez Rubio (<a href="#ref-Bayesian_INLA_Rubio" role="doc-biblioref">2020</a>)</span>, approximations of the joint posterior for the hyper paramer <span class="math inline">\(\tilde\pi\left(\psi_{k} \mid \boldsymbol{y}\right)\)</span> is used to compute the marginals for the latent effects anf hyper parameters in this way:</p>
<p><span class="math display">\[
\left.\tilde{\pi}(\boldsymbol{\psi} \mid \mathbf{y}) \propto \frac{\pi(\boldsymbol{\theta}, \boldsymbol{\psi}, y)}{\tilde{\pi}_{G}(\boldsymbol{\theta} \mid \boldsymbol{\psi}, y)}\right|_{\boldsymbol{\theta}=\boldsymbol{\theta}^{*}(\boldsymbol{\psi})}
\]</span>
In the previous equation <span class="math inline">\(\tilde{\pi}_{G}(\boldsymbol{\theta} \mid \boldsymbol{\psi}, y)\)</span> is a gaussian approximation to the full condition of the latent effect <span class="math inline">\({\theta}^{*}(\boldsymbol{\psi})\)</span> is the mode for a given value of the hyper param vector <span class="math inline">\(\boldsymbol{\psi}\)</span></p>
<p>At this point there exists three types of approximations for <span class="math inline">\(\pi\left(\boldsymbol{\theta} \mid \boldsymbol{\psi}, y\right)\)</span></p>
<ul>
<li>first with a gaussian approximation, estimating mean <span class="math inline">\(\mu_{i}(\boldsymbol{\psi})\)</span> and variance <span class="math inline">\(\sigma_{i}^{2}(\boldsymbol{\psi})\)</span>.</li>
<li>second using the <em>Laplace Approximation.</em></li>
<li>third using <em>simplified Laplace Approximation</em></li>
</ul>
<p>(rivedere meglio)</p>
</div>
</div>
<div id="r-inla-package-in-a-bayesian-perspective" class="section level2">
<h2><span class="header-section-number">5.3</span> R-INLA package in a bayesian perspective</h2>
<p>INLA computations and methodology is developed in the R-INLA project whose package is available on their <a href="http://www.r-inla.org">website</a>. Download is not available on CRAN (the Comprehensive R Archive Network) so a special source, which is maintained by authors and collaborators through a bitbucket repo, has to be specified. However download information are neatly showed in a dedicated section in the project website. The website offers also a forum where threads can be proposed and an active community is keen to answer. Furthermore the project is gaining importance due to its vast application a cases that recently are exponentiallly growing, examples are [italiano citato nel video onlie di RUE 2020, altro tizio citato da Rue]
The core function of the package is <code>inla()</code>and works as many other regression functions like <code>glm()</code> , <code>lm()</code> or <code>gam()</code>. Inla takes as arguments the formula together with the data (expects a data.frame obj) on which estimation is desired. Many other more alternative methods inside the function can be specifird and are later presented in a table. Inla objects are inla.dataframe summary-type list object containing the results from model fitting. Results contained in the object are specified in the table below, even though some of them requires special method to be seen: (meglio se metto direttamente tabella generate in kable())</p>
<div class="figure">
<img src="images/summarytable.PNG" alt="" />
<p class="caption">summary table list object, source: <span class="citation">Krainski (<a href="#ref-Krainski-Rubio" role="doc-biblioref">2019</a>)</span></p>
</div>
<div id="linear-predictor" class="section level3">
<h3><span class="header-section-number">5.3.1</span> Linear Predictor</h3>
<p>Follwing Krainski and Rubio <span class="citation">(<a href="#ref-Krainski-Rubio" role="doc-biblioref">2019</a>)</span> observations <span class="math inline">\(y(s_{1}), \ldots, y(s_{n})\)</span> come from a Gaussian variable with <span class="math inline">\(\mu_{i}\)</span> and precision <span class="math inline">\(\tau\)</span>. The mean moment <span class="math inline">\(\mu_{i}\)</span> has to be specified as <em>linear predictor</em> through a link function as in section @ref)(genregvec),i.e <span class="math inline">\(\eta_{i}=\beta_{0}+\sum_{m=1}^{M} \beta_{m} x_{m i}+\sum_{l=1}^{L} f_{l}\left(z_{l i}\right)\)</span>.
Simplifying the composition of the linear predictor and using spatial dataset SPDEtoy: Spatial covariates as long and lat have to be included in the linear predictor as well as the others, so that linear predictor has this form: <span class="math inline">\(\beta_{0}+\beta_{1} s_{1 i}+\beta_{2} s_{2 i}\)</span>, where once again <span class="math inline">\(\beta_{0}\)</span> is the intercept and <span class="math inline">\(\beta_{j}\)</span> are the linear effect on covariates. It is possible to include also non-linear effects with the <code>f()</code> specifying the model The prior choice for intercept is uniform. Prior for Gaussian latent field are vague such that have 0 mean and 0.001 precision, then the prior in the precision <span class="math inline">\(\tau\)</span> is gamma with parameters 1 and 0.00005. Prior choice can then be changes.</p>
<p>The summary of the model already described is:</p>
<p><span class="math display">\[
\begin{aligned}
y_{i} &amp; \sim N\left(\mu_{i}, \tau^{-1}\right), i=1, \ldots, 200 \\
\mu_{i} &amp;=\beta_{0}+\beta_{1} s_{1 i}+\beta_{2} s_{2 i} \\
\beta_{0} &amp; \sim \text { Uniform } \\
\beta_{j} &amp; \sim N\left(0,0.001^{-1}\right), j=1,2 \\
\tau &amp; \sim G a(1,0.00005)
\end{aligned}
\]</span></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="inla-spde.html#cb1-1"></a><span class="kw">library</span>(INLA)</span></code></pre></div>
<pre><code>## Loading required package: Matrix</code></pre>
<pre><code>## Loading required package: sp</code></pre>
<pre><code>## Warning: package &#39;sp&#39; was built under R version 4.0.3</code></pre>
<pre><code>## Loading required package: parallel</code></pre>
<pre><code>## Loading required package: foreach</code></pre>
<pre><code>## Warning: package &#39;foreach&#39; was built under R version 4.0.3</code></pre>
<pre><code>## This is INLA_20.09.16 built 2020-09-16 14:46:36 UTC.
##  - See www.r-inla.org/contact-us for how to get help.
##  - Save 375.4Mb of storage running &#39;inla.prune()&#39;</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="inla-spde.html#cb9-1"></a><span class="kw">data</span>(<span class="st">&quot;SPDEtoy&quot;</span>)</span>
<span id="cb9-2"><a href="inla-spde.html#cb9-2"></a>m0 =<span class="st"> </span><span class="kw">inla</span>(y <span class="op">~</span><span class="st"> </span>s1 <span class="op">+</span><span class="st"> </span>s2, <span class="dt">data =</span> SPDEtoy)</span>
<span id="cb9-3"><a href="inla-spde.html#cb9-3"></a><span class="kw">summary</span>(m0)</span></code></pre></div>
<pre><code>## 
## Call:
##    &quot;inla(formula = y ~ s1 + s2, data = SPDEtoy)&quot; 
## Time used:
##     Pre = 2.47, Running = 0.471, Post = 0.324, Total = 3.27 
## Fixed effects:
##               mean    sd 0.025quant 0.5quant 0.975quant   mode kld
## (Intercept) 10.132 0.242      9.656   10.132     10.608 10.132   0
## s1           0.762 0.429     -0.081    0.762      1.606  0.762   0
## s2          -1.584 0.429     -2.428   -1.584     -0.740 -1.584   0
## 
## Model hyperparameters:
##                                          mean    sd 0.025quant 0.5quant
## Precision for the Gaussian observations 0.308 0.031      0.251    0.307
##                                         0.975quant  mode
## Precision for the Gaussian observations      0.372 0.305
## 
## Expected number of effective parameters(stdev): 3.00(0.00)
## Number of equivalent replicates : 66.67 
## 
## Marginal log-Likelihood:  -423.18</code></pre>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-Bayesian_INLA_Rubio">
<p>Gómez Rubio, Virgilio. 2020. <em>Bayesian Inference with Inla</em>. Chapman; Hall/CRC. <a href="https://doi.org/10.1201/9781315175584">https://doi.org/10.1201/9781315175584</a>.</p>
</div>
<div id="ref-Krainski-Rubio">
<p>Krainski, Elias T. 2019. <em>Advanced Spatial Modeling with Stochastic Partial Differential Equations Using R and Inla</em>. Chapman; Hall/CRC.</p>
</div>
<div id="ref-Blangiardo-Cameletti">
<p>Marta Blangiardo, Michela Cameletti. 2015. <em>Spatial and Spatio-Temporal Bayesian Models with R-Inla</em>. Wiley.</p>
</div>
<div id="ref-Moraga2019">
<p>Moraga, Paula. 2019. <em>Geospatial Health Data</em>. Chapman; Hall/CRC. <a href="https://doi.org/10.1201/9780429341823">https://doi.org/10.1201/9780429341823</a>.</p>
</div>
<div id="ref-Rue2009">
<p>Rue, Håvard, Sara Martino, and Nicolas Chopin. 2009. “Approximate Bayesian Inference for Latent Gaussian Models by Using Integrated Nested Laplace Approximations.” <em>Journal of the Royal Statistical Society: Series B (Statistical Methodology)</em> 71 (2): 319–92. <a href="https://doi.org/10.1111/j.1467-9868.2008.00700.x">https://doi.org/10.1111/j.1467-9868.2008.00700.x</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="exploratory.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="prdm.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": true,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin"],
"google": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/NiccoloSalvini/Thesis/edit/master/05-inla.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Niccolo_Salvini_Thesis.pdf", "Niccolo_Salvini_Thesis.epub"],
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"search": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
