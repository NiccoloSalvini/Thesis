<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Exploratory Analysis | REST Scraping API for Real Estate data, a Spatial Bayesian modeling perspective with INLA</title>
  <meta name="description" content="Niccolò Salvini master’s thesis project" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Exploratory Analysis | REST Scraping API for Real Estate data, a Spatial Bayesian modeling perspective with INLA" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://niccolosalvini.github.io/Thesis/" />
  <meta property="og:image" content="https://niccolosalvini.github.io/Thesis/images/spat-touch.png" />
  <meta property="og:description" content="Niccolò Salvini master’s thesis project" />
  <meta name="github-repo" content="NiccoloSalvini/Thesis" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Exploratory Analysis | REST Scraping API for Real Estate data, a Spatial Bayesian modeling perspective with INLA" />
  
  <meta name="twitter:description" content="Niccolò Salvini master’s thesis project" />
  <meta name="twitter:image" content="https://niccolosalvini.github.io/Thesis/images/spat-touch.png" />

<meta name="author" content="Niccolò Salvini" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="images/spatial.png" />
  <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
<link rel="prev" href="spde.html"/>
<link rel="next" href="modelspec.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.2/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.3/leaflet.js"></script>
<link href="libs/leaflet-minimap-3.3.1/Control.MiniMap.min.css" rel="stylesheet" />
<script src="libs/leaflet-minimap-3.3.1/Control.MiniMap.min.js"></script>
<script src="libs/leaflet-minimap-3.3.1/Minimap-binding.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-171723874-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-171723874-1');
</script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="./"><img src="images/transspatial.PNG"></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preliminary Content</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#abstract"><i class="fa fa-check"></i>Abstract</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#dedication"><i class="fa fa-check"></i>Dedication</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="scraping.html"><a href="scraping.html"><i class="fa fa-check"></i><b>2</b> Web Scraping</a><ul>
<li class="chapter" data-level="2.1" data-path="scraping.html"><a href="scraping.html#web-scraping"><i class="fa fa-check"></i><b>2.1</b> Web Scraping</a></li>
<li class="chapter" data-level="2.2" data-path="scraping.html"><a href="scraping.html#graph-representation-of-html"><i class="fa fa-check"></i><b>2.2</b> Graph Representation of HTML</a></li>
<li class="chapter" data-level="2.3" data-path="scraping.html"><a href="scraping.html#crawling"><i class="fa fa-check"></i><b>2.3</b> Crawling</a></li>
<li class="chapter" data-level="2.4" data-path="scraping.html"><a href="scraping.html#proper-scraping"><i class="fa fa-check"></i><b>2.4</b> Proper Scraping</a><ul>
<li class="chapter" data-level="2.4.1" data-path="scraping.html"><a href="scraping.html#webstructure"><i class="fa fa-check"></i><b>2.4.1</b> Immobiliare.it website structure</a></li>
<li class="chapter" data-level="2.4.2" data-path="scraping.html"><a href="scraping.html#immobiliare.it-content-architecture-with-rvest"><i class="fa fa-check"></i><b>2.4.2</b> Immobiliare.it content architecture with <code id="ContentArchitecture">rvest</code></a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="scraping.html"><a href="scraping.html#ProperScraping"><i class="fa fa-check"></i><b>2.5</b> Proper Scarping</a></li>
<li class="chapter" data-level="2.6" data-path="scraping.html"><a href="scraping.html#best-practices"><i class="fa fa-check"></i><b>2.6</b> Scraping Best Practices and Security provisions</a></li>
<li class="chapter" data-level="2.7" data-path="scraping.html"><a href="scraping.html#web-client-security-provisions-user-agents-proxies-and-fail-dealers"><i class="fa fa-check"></i><b>2.7</b> Web Client Security provisions: User Agents, Proxies and Fail Dealers</a><ul>
<li class="chapter" data-level="2.7.1" data-path="scraping.html"><a href="scraping.html#spoofing"><i class="fa fa-check"></i><b>2.7.1</b> HTTP User Agent and Mail Spoofing</a></li>
<li class="chapter" data-level="2.7.2" data-path="scraping.html"><a href="scraping.html#possibly"><i class="fa fa-check"></i><b>2.7.2</b> Dealing with failure</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="scraping.html"><a href="scraping.html#parallelscraping"><i class="fa fa-check"></i><b>2.8</b> Parallel Scraping</a><ul>
<li class="chapter" data-level="2.8.1" data-path="scraping.html"><a href="scraping.html#parallel-furrrfuture"><i class="fa fa-check"></i><b>2.8.1</b> Parallel furrr+future</a></li>
<li class="chapter" data-level="2.8.2" data-path="scraping.html"><a href="scraping.html#parallel-foreachdofuture"><i class="fa fa-check"></i><b>2.8.2</b> Parallel foreach+doFuture</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="scraping.html"><a href="scraping.html#challenges"><i class="fa fa-check"></i><b>2.9</b> Open Challenges and Further Improvemements</a></li>
<li class="chapter" data-level="2.10" data-path="scraping.html"><a href="scraping.html#legal-profiles"><i class="fa fa-check"></i><b>2.10</b> Legal Profiles</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="Infrastructure.html"><a href="Infrastructure.html"><i class="fa fa-check"></i><b>3</b> API Technologies Stack</a><ul>
<li class="chapter" data-level="3.1" data-path="Infrastructure.html"><a href="Infrastructure.html#scheduler"><i class="fa fa-check"></i><b>3.1</b> Scheduler</a><ul>
<li class="chapter" data-level="3.1.1" data-path="Infrastructure.html"><a href="Infrastructure.html#cron-jobs"><i class="fa fa-check"></i><b>3.1.1</b> Cron Jobs</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="Infrastructure.html"><a href="Infrastructure.html#rest-api"><i class="fa fa-check"></i><b>3.2</b> REST API</a><ul>
<li class="chapter" data-level="3.2.1" data-path="Infrastructure.html"><a href="Infrastructure.html#plumberapi"><i class="fa fa-check"></i><b>3.2.1</b> Plumber REST API</a></li>
<li class="chapter" data-level="3.2.2" data-path="Infrastructure.html"><a href="Infrastructure.html#immobiliare.it-parallel-rest-api"><i class="fa fa-check"></i><b>3.2.2</b> Immobiliare.it <em>Parallel</em> REST API</a></li>
<li class="chapter" data-level="3.2.3" data-path="Infrastructure.html"><a href="Infrastructure.html#APIdocs"><i class="fa fa-check"></i><b>3.2.3</b> REST API documentation</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="Infrastructure.html"><a href="Infrastructure.html#docker"><i class="fa fa-check"></i><b>3.3</b> Docker</a><ul>
<li class="chapter" data-level="3.3.1" data-path="Infrastructure.html"><a href="Infrastructure.html#why-docker"><i class="fa fa-check"></i><b>3.3.1</b> Why Docker</a></li>
<li class="chapter" data-level="3.3.2" data-path="Infrastructure.html"><a href="Infrastructure.html#dockerfile"><i class="fa fa-check"></i><b>3.3.2</b> Dockerfile</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="Infrastructure.html"><a href="Infrastructure.html#aws"><i class="fa fa-check"></i><b>3.4</b> AWS EC2 instance</a><ul>
<li class="chapter" data-level="3.4.1" data-path="Infrastructure.html"><a href="Infrastructure.html#launch-an-ec2-instance"><i class="fa fa-check"></i><b>3.4.1</b> Launch an EC2 instance</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="Infrastructure.html"><a href="Infrastructure.html#nginx"><i class="fa fa-check"></i><b>3.5</b> NGINX reverse proxy server</a></li>
<li class="chapter" data-level="3.6" data-path="Infrastructure.html"><a href="Infrastructure.html#software-development-workflow"><i class="fa fa-check"></i><b>3.6</b> Software development Workflow</a></li>
<li class="chapter" data-level="3.7" data-path="Infrastructure.html"><a href="Infrastructure.html#further-integrations"><i class="fa fa-check"></i><b>3.7</b> Further Integrations</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="inla.html"><a href="inla.html"><i class="fa fa-check"></i><b>4</b> INLA computation</a><ul>
<li class="chapter" data-level="4.1" data-path="inla.html"><a href="inla.html#LGM"><i class="fa fa-check"></i><b>4.1</b> Latent Gaussian Models LGM</a></li>
<li class="chapter" data-level="4.2" data-path="inla.html"><a href="inla.html#approx"><i class="fa fa-check"></i><b>4.2</b> Approximation in INLA setting</a><ul>
<li class="chapter" data-level="4.2.1" data-path="inla.html"><a href="inla.html#further-approximations-prolly-do-not-note-include"><i class="fa fa-check"></i><b>4.2.1</b> further approximations (prolly do not note include)</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="inla.html"><a href="inla.html#rinla"><i class="fa fa-check"></i><b>4.3</b> R-INLA package in a bayesian hierarchical regression perspective</a><ul>
<li class="chapter" data-level="4.3.1" data-path="inla.html"><a href="inla.html#overview"><i class="fa fa-check"></i><b>4.3.1</b> Overview</a></li>
<li class="chapter" data-level="4.3.2" data-path="inla.html"><a href="inla.html#example"><i class="fa fa-check"></i><b>4.3.2</b> Linear Predictor</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="prdm.html"><a href="prdm.html"><i class="fa fa-check"></i><b>5</b> Point Referenced Data Modeling</a><ul>
<li class="chapter" data-level="5.1" data-path="prdm.html"><a href="prdm.html#GP"><i class="fa fa-check"></i><b>5.1</b> Gaussian Process (GP)</a></li>
<li class="chapter" data-level="5.2" data-path="prdm.html"><a href="prdm.html#spatial-covariance-function"><i class="fa fa-check"></i><b>5.2</b> Spatial Covariance Function</a><ul>
<li class="chapter" data-level="5.2.1" data-path="prdm.html"><a href="prdm.html#Matern"><i class="fa fa-check"></i><b>5.2.1</b> Matérn Covariance Function</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="prdm.html"><a href="prdm.html#hedonic-models-literature-review-and-spatial-hedonic-price-models"><i class="fa fa-check"></i><b>5.3</b> Hedonic models Literature Review and Spatial Hedonic Price Models</a></li>
<li class="chapter" data-level="5.4" data-path="prdm.html"><a href="prdm.html#univariateregr"><i class="fa fa-check"></i><b>5.4</b> Point Referenced Regression for univariate spatial data</a></li>
<li class="chapter" data-level="5.5" data-path="prdm.html"><a href="prdm.html#hiermod"><i class="fa fa-check"></i><b>5.5</b> Hierarchical Bayesian models</a></li>
<li class="chapter" data-level="5.6" data-path="prdm.html"><a href="prdm.html#finalregr"><i class="fa fa-check"></i><b>5.6</b> INLA model through spatial hierarchical regression</a></li>
<li class="chapter" data-level="5.7" data-path="prdm.html"><a href="prdm.html#spatial-kriging"><i class="fa fa-check"></i><b>5.7</b> Spatial Kriging</a></li>
<li class="chapter" data-level="5.8" data-path="prdm.html"><a href="prdm.html#model-checking"><i class="fa fa-check"></i><b>5.8</b> Model Checking</a></li>
<li class="chapter" data-level="5.9" data-path="prdm.html"><a href="prdm.html#prior-specification"><i class="fa fa-check"></i><b>5.9</b> Prior Specification</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="spde.html"><a href="spde.html"><i class="fa fa-check"></i><b>6</b> SPDE approach</a><ul>
<li class="chapter" data-level="6.1" data-path="spde.html"><a href="spde.html#set-spde-problem"><i class="fa fa-check"></i><b>6.1</b> Set SPDE Problem</a></li>
<li class="chapter" data-level="6.2" data-path="spde.html"><a href="spde.html#spde-within-r-inla"><i class="fa fa-check"></i><b>6.2</b> SPDE within R-INLA</a></li>
<li class="chapter" data-level="6.3" data-path="spde.html"><a href="spde.html#first-point-krainsky-rubio-too-technical"><i class="fa fa-check"></i><b>6.3</b> First Point Krainsky Rubio TOO TECHNICAL</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="exploratory.html"><a href="exploratory.html"><i class="fa fa-check"></i><b>7</b> Exploratory Analysis</a><ul>
<li class="chapter" data-level="7.1" data-path="exploratory.html"><a href="exploratory.html#prep"><i class="fa fa-check"></i><b>7.1</b> Data preparation</a><ul>
<li class="chapter" data-level="7.1.1" data-path="exploratory.html"><a href="exploratory.html#maps-and-geo-visualisations"><i class="fa fa-check"></i><b>7.1.1</b> Maps and Geo-Visualisations</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="exploratory.html"><a href="exploratory.html#counts-and-first-orientations"><i class="fa fa-check"></i><b>7.2</b> Counts and First Orientations</a></li>
<li class="chapter" data-level="7.3" data-path="exploratory.html"><a href="exploratory.html#text-mining-in-estate-review"><i class="fa fa-check"></i><b>7.3</b> Text Mining in estate Review</a></li>
<li class="chapter" data-level="7.4" data-path="exploratory.html"><a href="exploratory.html#missing-assessement-and-imputation"><i class="fa fa-check"></i><b>7.4</b> Missing Assessement and Imputation</a><ul>
<li class="chapter" data-level="7.4.1" data-path="exploratory.html"><a href="exploratory.html#missing-assessement"><i class="fa fa-check"></i><b>7.4.1</b> Missing assessement</a></li>
<li class="chapter" data-level="7.4.2" data-path="exploratory.html"><a href="exploratory.html#covariates-imputation"><i class="fa fa-check"></i><b>7.4.2</b> Covariates Imputation</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="exploratory.html"><a href="exploratory.html#model-specification"><i class="fa fa-check"></i><b>7.5</b> Model Specification</a></li>
<li class="chapter" data-level="7.6" data-path="exploratory.html"><a href="exploratory.html#mesh-building"><i class="fa fa-check"></i><b>7.6</b> Mesh building</a><ul>
<li class="chapter" data-level="7.6.1" data-path="exploratory.html"><a href="exploratory.html#shinyapp-for-mesh-assessment"><i class="fa fa-check"></i><b>7.6.1</b> Shinyapp for mesh assessment</a></li>
<li class="chapter" data-level="7.6.2" data-path="exploratory.html"><a href="exploratory.html#building-spde-model-on-mesh"><i class="fa fa-check"></i><b>7.6.2</b> BUilding SPDE model on mesh</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="exploratory.html"><a href="exploratory.html#spatial-kriging-prediction"><i class="fa fa-check"></i><b>7.7</b> Spatial Kriging (Prediction)</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="modelspec.html"><a href="modelspec.html"><i class="fa fa-check"></i><b>8</b> Model Selection &amp; Fitting</a><ul>
<li class="chapter" data-level="8.1" data-path="modelspec.html"><a href="modelspec.html#model-criticism"><i class="fa fa-check"></i><b>8.1</b> Model Criticism</a></li>
<li class="chapter" data-level="8.2" data-path="modelspec.html"><a href="modelspec.html#spatial-kriging-1"><i class="fa fa-check"></i><b>8.2</b> Spatial Kriging</a></li>
<li class="chapter" data-level="8.3" data-path="modelspec.html"><a href="modelspec.html#model-checking-1"><i class="fa fa-check"></i><b>8.3</b> Model Checking</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="application.html"><a href="application.html"><i class="fa fa-check"></i><b>9</b> Shiny Application</a></li>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i>Appendix</a><ul>
<li class="chapter" data-level="9.1" data-path="appendix.html"><a href="appendix.html#gp-basics"><i class="fa fa-check"></i><b>9.1</b> GP basics</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/NiccoloSalvini/tesi-prova" target="blank"> See Github Repository</a></li>
<li><a href="https://niccolosalvini.netlify.app/">About The Author</a></li>
<li><a Proudly published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">REST Scraping API for Real Estate data, a Spatial Bayesian modeling perspective with INLA</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="exploratory" class="section level1">
<h1><span class="header-section-number">Chapter 7</span> Exploratory Analysis</h1>
<!--  You can label chapter and section titles using `{#label}` after them, e.g., we can reference Chapter \@ref(intro). If you do not manually label them, there will be automatic labels anyway, e.g., Chapter \@ref(methods).-->
<p>Data flows out the REST API end point <code>*/complete</code> in a .json format. Data can be filtered out On the basis of the options set in the API endpoint argument body. Some of the options supplied to the API, as in section <a href="Infrastructure.html#APIdocs">3.2.3</a>, might regard the real estate <code>city</code> interested, <code>npages</code> as the number of pages to scrape, <code>type</code> as the choice between rental of selling market. Since to the analysis extent data should come from the same geographic area API, city and filter parameters are kept permanent (e.g. Milan rental real estate within “circonvallazione” approximated geo-borders). As a consequence a dedicated endpoint <code>.thesis</code> parameter is passed in the argument body. By setting the option equal to to TRUE the API caller requests thesis data. In other words the latter option under the hood secures to specify to the API an already composed query url to be passed to the scraping endppoint, which corresponds to precise zones imposed while searching for advertisemnts on Immobiliare.it. To help figure out the idea behind the operation it can be thought as refreshing everyday the same immobiliare.it url on their website looking for accomodations within a specified zone.
Parameters specified are also npages = 120, leading to to 3000 observations. The <code>*</code> refers to the EC2 public DNS.</p>
<p><code>http://*/complete/120/milano/affitto/.thesis=true</code></p>
<p>As a further data source is available a mondgoDB ATLAS cluster which, because of the scheduler, stocks daily .csv information from Milan real estate. Credentials have to be supplied. For run time reasons also related to the bookdown files continuous building the API endpoint is not called and code chunks outputs are cached due to heavy computation. Instead data is extracted from the MongoDB cluster. A summary table of the columns involved is presented with the goal to introduce the reader to API incoming data. Data needs some heavy preprocess steps to get modeled which is briefly covered in the data preparation part in section <a href="exploratory.html#prep">7.1</a>. Data coming from the /complete enndpoint has a geo-statistical spatial component and consequently a spatial representation of the dataset is showed. One further plot points out that geographic coordinates are non-linearly related <a href="exploratory.html#fig:NonLinearSpatialRel">7.2</a> to the price response variable so dedicated techniques are required. Exploration starts with factor counts evidencing a “Bilocale” prevalence which is then compared to other cities. This suggest some critical Milan real estate market demand information and consequently reflections on the offer. Heating and cooling systems, two of the covariates extracted, are grouped and then arranged by descending order prevalence. They both do not display any significative price change but they bring to the surface an important environmental concern. The same is done by highlighting ridges distribution for other two newly engineered covariates. Data displays bimodality in prices distribution for different n-roomed accommodations and the model should take account of the behavior. Then a piece-wise linear regression is fitted for each n-roomed accommodation sub-group whose single predictor is the square meter footage. The analysis emphasize some valuable economic consequences both for investors interested into property expansions and for tenants that are planning to partition single properties into rentable sub-units. The previous analysis brings along a major question which regards the most valuable properties per single square meter surface and a answer based on data is given. Then a further log linear regression setting is proposed to evaluate the impact of some other presumably important covariate. A Tie Fighter plot displays for which coefficient, associated to each dummyied predictor, there are surprisingly high prices compared to the effect of the square meter footage expansion. A partial conclusion is that having 2 or 3 bathrooms truly pays an extra monthly gain, also caused by the number of tentants the accomodations could host. Then missing assessement and imputation takes place. At first is made a brief a revision of missing and randomnes by <span class="citation">Little and Rubin (<a href="#ref-Little" role="doc-biblioref">2014</a>)</span>, then theory is applied by visualizing missing in combination with heat-map and co-occurrence plot. Combined missing observation test is able to detect whether data is missing because of inner scraping faiilures or simple rarity in data appereance. Then for the observations that passed the test imputation is made through INLA posterior expectation. That is the case of data lost in predictors so the missing covariates ( <em>condominium</em> ) are brought into a model as response variable whose this time predictors are explanatory ones. Through a method specified within the INLA function the posterior statistics are computed and then finally imputed in the place of missing ones.</p>
<p>Visualisations are done with ggplot2 in a Tidyverse approach. Maps are done with ggplot2 too and Leaflet, together with its extensions.
A preliminary API data exploratory analysis evidences 34 covariates and 250 rows, which are once again conditioned to the query sent to the API. Immobiliare.it furnishes many information regarding property attributes and estate agency circumstances. Data displays many NA in some of the columns but georeference coordinates, due to the design of scraping functions, are in any case present.</p>
<table>
<thead>
<tr>
<th style="text-align:left;">
name
</th>
<th style="text-align:left;">
ref
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
ID
</td>
<td style="text-align:left;">
ID of the apartements
</td>
</tr>
<tr>
<td style="text-align:left;">
LAT
</td>
<td style="text-align:left;">
latitude coordinate
</td>
</tr>
<tr>
<td style="text-align:left;">
LONG
</td>
<td style="text-align:left;">
longitude coordinate
</td>
</tr>
<tr>
<td style="text-align:left;">
LOCATION
</td>
<td style="text-align:left;">
the complete address: street name and number
</td>
</tr>
<tr>
<td style="text-align:left;">
CONDOM
</td>
<td style="text-align:left;">
the condominium monthly expenses
</td>
</tr>
<tr>
<td style="text-align:left;">
BUILDAGE
</td>
<td style="text-align:left;">
the age in which the building was contructed
</td>
</tr>
<tr>
<td style="text-align:left;">
FLOOR
</td>
<td style="text-align:left;">
the property floor
</td>
</tr>
<tr>
<td style="text-align:left;">
INDIVSAPT
</td>
<td style="text-align:left;">
indipendent property type versus apartement type
</td>
</tr>
<tr>
<td style="text-align:left;">
LOCALI
</td>
<td style="text-align:left;">
specification of the type and number of rooms
</td>
</tr>
<tr>
<td style="text-align:left;">
TPPROP
</td>
<td style="text-align:left;">
property type residential or not
</td>
</tr>
<tr>
<td style="text-align:left;">
STATUS
</td>
<td style="text-align:left;">
the actual status of the house, ristrutturato, nuovo, abitabile
</td>
</tr>
<tr>
<td style="text-align:left;">
HEATING
</td>
<td style="text-align:left;">
the heating system Cen_Rad_Gas (centralizzato a radiatori, alim a gas), Cen_Rad_Met,
</td>
</tr>
<tr>
<td style="text-align:left;">
AC
</td>
<td style="text-align:left;">
air conditioning hot and cold, Autonomo, freddo/caldo, Centralizzato, freddo/caldo
</td>
</tr>
<tr>
<td style="text-align:left;">
PUB_DATE
</td>
<td style="text-align:left;">
the date of publication of the advertisement
</td>
</tr>
<tr>
<td style="text-align:left;">
CATASTINFO
</td>
<td style="text-align:left;">
land registry information
</td>
</tr>
<tr>
<td style="text-align:left;">
APTCHAR
</td>
<td style="text-align:left;">
apartement main characteristics
</td>
</tr>
<tr>
<td style="text-align:left;">
PHOTOSNUM
</td>
<td style="text-align:left;">
number of photos displayed in the advertisement
</td>
</tr>
<tr>
<td style="text-align:left;">
AGE
</td>
<td style="text-align:left;">
real estate agency name
</td>
</tr>
<tr>
<td style="text-align:left;">
LOWRDPRICE_ORIGINAL_PRICE
</td>
<td style="text-align:left;">
If the price is lowered it flags the starting price
</td>
</tr>
<tr>
<td style="text-align:left;">
LOWRDPRICE_CURRENT_PRICE
</td>
<td style="text-align:left;">
If the price is lowered it flags the current price
</td>
</tr>
<tr>
<td style="text-align:left;">
LOWRDPRICE_PASSED_DAYS
</td>
<td style="text-align:left;">
If the price is lowered indicates the days passed since the price has changed
</td>
</tr>
<tr>
<td style="text-align:left;">
LOWRDPRICE_DATE
</td>
<td style="text-align:left;">
If the price is lowered indicates the date the price has changed
</td>
</tr>
<tr>
<td style="text-align:left;">
ENCLASS
</td>
<td style="text-align:left;">
the energy class according to the land registers
</td>
</tr>
<tr>
<td style="text-align:left;">
CONTR
</td>
<td style="text-align:left;">
the type of contract
</td>
</tr>
<tr>
<td style="text-align:left;">
DISP
</td>
<td style="text-align:left;">
if it is still avaiable or already rented
</td>
</tr>
<tr>
<td style="text-align:left;">
TOTPIANI
</td>
<td style="text-align:left;">
the total number of the building floors
</td>
</tr>
<tr>
<td style="text-align:left;">
PAUTO
</td>
<td style="text-align:left;">
number of parking box or garages avaibable in the property
</td>
</tr>
<tr>
<td style="text-align:left;">
REVIEW
</td>
<td style="text-align:left;">
estate agency review, long chr string
</td>
</tr>
<tr>
<td style="text-align:left;">
HASMULTI
</td>
<td style="text-align:left;">
it if has multimedia option, such as 3D house vitualization home experience or videos
</td>
</tr>
<tr>
<td style="text-align:left;">
PRICE
</td>
<td style="text-align:left;">
the monthly price &lt;- response
</td>
</tr>
<tr>
<td style="text-align:left;">
SQFEET
</td>
<td style="text-align:left;">
square meters footage
</td>
</tr>
<tr>
<td style="text-align:left;">
NROOM
</td>
<td style="text-align:left;">
the number of rooms in the house, and their types
</td>
</tr>
<tr>
<td style="text-align:left;">
TITLE
</td>
<td style="text-align:left;">
title of published advertisement
</td>
</tr>
</tbody>
</table>
<div id="prep" class="section level2">
<h2><span class="header-section-number">7.1</span> Data preparation</h2>
<p>Data needs to undergo to many previous cleaning preprocess steps, this is a forced stage since API data comes in human readable format, which is not prepared to be modeled. Cleaning steps mainly regards:</p>
<ul>
<li>encoding from UTF-8 to Latin due to Italian characters incorrectly parsed.</li>
<li><em>floors</em> covariate needs to be separated by its <em>ascensore</em> and <em>accdisabili</em> components, adding 2 more bivariate covariates.</li>
<li><em>locali</em> needs to be separated too. 5 category levels drain out: <em>totlocali</em>, <em>camereletto</em>, <em>altro</em>, <em>bagno</em>, <em>cucina</em>. <em>nroom</em> is a duplicate for <em>totlocali</em>, so it is discarded.</li>
<li><em>aptchar</em> is a character strign column that contains a various number of different features per house. The preprocess steps include cleaning the string from unnecessary characters, then finding the whole set of unique elements across the character column by splitting on a regex pattern, in the end recoding newly created bivariate columns “yes” or “no” accoeding to a matching pattern whether the feature appears in the string not. A slice from the API output APTCHAR is:</li>
</ul>
<p>fibra ottica videocitofono impianto di allarme porta blindata reception balcone portiere intera giornata impianto tv centralizzato parzialmente arredato esposizione doppia</p>
<div id="maps-and-geo-visualisations" class="section level3">
<h3><span class="header-section-number">7.1.1</span> Maps and Geo-Visualisations</h3>
<p>Geographic coordinates can be represented on a map in order to reveal first symptoms of spatial autocorrelation. Observations are spread almost equally throughout the surface even though the response var <em>price</em> indicates unsurprisingly that higher prices are nearer to the city center.
The map in figure @ref(fig:leaflet_visuals) is a leaflet object, which needs to be overlapped with layers indicating different maps projections. This is interactive in the .html version, and static is proposed in the .pdf output version. The map object takes a input the latitute and longitude coordinates coming from THE API, and they do not need any CRS (Coordinate Reference System) projection since leaflet can accept the data type.</p>
<div class="figure"><span id="fig:LeafletVisuals"></span>
<div id="htmlwidget-3a8ddcccd0e6c936012c" style="width:100%;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-3a8ddcccd0e6c936012c">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"setView":[[45.474211,9.191383],13,[]],"calls":[{"method":"addMiniMap","args":[null,null,"bottomright",150,150,19,19,-5,false,false,false,false,false,false,{"color":"#ff7800","weight":1,"clickable":false},{"color":"#000000","weight":1,"clickable":false,"opacity":0,"fillOpacity":0},{"hideText":"Hide MiniMap","showText":"Show MiniMap"},[]]},{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addCircles","args":[[45.477,45.4709,45.4605,45.4709,45.4709,45.476,45.4753,45.4694,45.4813,45.4771,45.4534,45.4612,45.4969,45.4919,45.4825,45.4513,45.4495,45.4732,45.4632,45.4657,45.4481,45.4444,45.4555,45.4794,45.4659,45.4694,45.4706,45.4877,45.4815,45.4824,45.4781,45.4488,45.4668,45.4593,45.4731,45.4813,45.4771,45.4805,45.471,45.4705,45.49,45.4566,45.4608,45.4439,45.4921,45.4705,45.4528,45.4795,45.4733,45.4596,45.4616,45.4699,45.4568,45.49,45.4826,45.4747,45.4567,45.4569,45.4759,45.4863,45.4777,45.4712,45.4604,45.4647,45.4917,45.4746,45.4717,45.4618,45.4836,45.4656,45.4642,45.452,45.4725,45.4833,45.4573,45.4477,45.4865,45.4729,45.4789,45.455,45.4669,45.4515,45.4699,45.4683,45.4914,45.4809,45.4648,45.4797,45.4583,45.4631,45.4592,45.4547,45.4568,45.4693,45.4583,45.4747,45.4567,45.4616,45.472,45.4823,45.4615,45.4726,45.4801,45.4626,45.4621,45.4684,45.4778,45.4805,45.4529,45.4847,45.4597,45.4631,45.4467,45.459,45.4897,45.4551,45.4472,45.4472,45.4657,45.4467,45.4779,45.4897,45.4468,45.4722,45.4726,45.4865,45.4761,45.4656,45.4701,45.4701,45.4467,45.4707,45.4584,45.4567,45.4773,45.4659,45.4856,45.4513,45.4668,45.4584,45.4812,45.4628,45.4511,45.4774,45.487,45.4769,45.4482,45.4643,45.4843,45.4879,45.4897,45.4621,45.4878,45.477,45.4876,45.4842,45.488,45.4793,45.4548,45.4668,45.4654,45.4702,45.4819,45.4432,45.4668,45.4657,45.4747,45.4674,45.4897,45.4714,45.478,45.4662,45.4729,45.4783,45.4666,45.4572,45.4709,45.4656,45.4859,45.474,45.4879,45.48,45.4909,45.4787,45.4909,45.4651,45.4674,45.4581,45.4583,45.4461,45.4659,45.4715,45.4558,45.4669,45.4634,45.4512,45.4574,45.4857,45.4639,45.4554,45.4514,45.4593,45.4723,45.4733,45.4797,45.476,45.4815,45.4464,45.4737,45.4797,45.4878,45.4887,45.4863,45.4734,45.4812,45.49,45.4739,45.4729,45.4449,45.4814,45.456,45.467,45.4544,45.4677,45.4863,45.4713,45.4547,45.4452,45.4705,45.4897,45.4895,45.5036,45.4564,45.4726,45.4583,45.4681,45.4671,45.4664,45.4701,45.4791,45.4779,45.4708,45.459,45.4878,45.4748,45.4732,45.4725,45.4785,45.4765,45.471],[9.15101,9.20868,9.18927,9.20868,9.20868,9.2116,9.205,9.1583,9.1884,9.20441,9.2193,9.2035,9.1853,9.2077,9.1736,9.1852,9.1996,9.2063,9.22367,9.1708,9.1769,9.1764,9.1875,9.1877,9.2064,9.2186,9.1517,9.2027,9.2102,9.1851,9.1899,9.1617,9.2159,9.2071,9.1887,9.1792,9.1842,9.2126,9.1876,9.1963,9.2191,9.207,9.2307,9.1802,9.1861,9.2035,9.19494,9.216,9.2144,9.1797,9.19053,9.1867,9.2147,9.1645,9.2005,9.1834,9.1873,9.2143,9.1708,9.2336,9.17866,9.19181,9.1765,9.1664,9.2184,9.2221,9.2035,9.2144,9.1677,9.152,9.1988,9.1783,9.1886,9.17095,9.1805,9.159,9.188,9.2133,9.1785,9.1668,9.1973,9.156,9.18366,9.16652,9.18645,9.1998,9.1566,9.2195,9.2071,9.1988,9.2008,9.17209,9.21036,9.19777,9.1541,9.18837,9.1749,9.2213,9.23739,9.22107,9.1552,9.1859,9.2031,9.2,9.2098,9.1776,9.188,9.192,9.1663,9.1626,9.207,9.1808,9.18773,9.2139,9.2059,9.2001,9.1981,9.1789,9.2307,9.19687,9.211,9.203,9.1656,9.21577,9.1924,9.1901,9.2242,9.2055,9.19498,9.1905,9.1637,9.20858,9.1859,9.1873,9.2103,9.21327,9.1976,9.17325,9.156,9.1809,9.2253,9.1812,9.19242,9.2159,9.1568,9.2169,9.1886,9.1794,9.1636,9.187,9.1831,9.2034,9.22375,9.15101,9.1861,9.17174,9.18815,9.18943,9.18425,9.22555,9.21241,9.16526,9.1558,9.21717,9.1505,9.20925,9.20954,9.1523,9.22575,9.2005,9.18341,9.18085,9.1872,9.2192,9.16,9.17552,9.148,9.18,9.1536,9.182,9.1854,9.1659,9.1864,9.1612,9.1864,9.20754,9.15785,9.1611,9.2076,9.1787,9.1836,9.19277,9.1536,9.18362,9.2096,9.177,9.17329,9.1523,9.1809,9.17614,9.2009,9.1726,9.1969,9.1878,9.1606,9.2103,9.21866,9.177,9.2091,9.1933,9.15496,9.2256,9.1601,9.15177,9.17738,9.20619,9.19306,9.1847,9.1792,9.2058,9.19941,9.18167,9.1738,9.16242,9.156,9.1842,9.18042,9.1721,9.1841,9.1486,9.1675,9.1932,9.2119,9.1924,9.1523,9.1919,9.2018,9.15971,9.197,9.18407,9.17939,9.21233,9.1803,9.1913,9.1442,9.21961,9.2279,9.2225,9.1603,9.1876],[7.80384330353877,7.09007683577609,8.00636756765025,7.17011954344963,7.43838353004431,8.25582842728183,8.51719319141624,7.97796809312855,7.97246601597457,7.09007683577609,6.39692965521615,8.1605182474775,6.90775527898214,7.27931883541462,6.95654544315157,7.22620901010067,6.62007320653036,7.97246601597457,6.95654544315157,7.3132203870903,6.90775527898214,7.00306545878646,7.52294091807237,6.95654544315157,7.3132203870903,7.71868549519847,7.3132203870903,7.09007683577609,6.69703424766648,6.80239476332431,7.60090245954208,7.09007683577609,7.09007683577609,6.75693238924755,7.69621263934641,7.43838353004431,7.90100705199242,7.43838353004431,7.82404601085629,7.91935619066062,6.80239476332431,7.20785987143248,6.86484777797086,6.47697236288968,7.09007683577609,8.20685642839965,8.1605182474775,7.00306545878646,7.09007683577609,7.00306545878646,7.34601020991329,7.54960916515453,6.74523634948436,7.3132203870903,7.54960916515453,7.60090245954208,7.43838353004431,7.24422751560335,7.26542972325395,7.37775890822787,6.68461172766793,8.1605182474775,7.0475172213573,7.90100705199242,6.7093043402583,7.60090245954208,8.00636756765025,7.00306545878646,7.27239839257005,6.84587987526405,7.00306545878646,8.00636756765025,8.00636756765025,6.80239476332431,6.8351845861473,6.85646198459459,6.5510803350434,7.09007683577609,7.0475172213573,6.85646198459459,7.5137092478397,7.09007683577609,7.43838353004431,7.17011954344963,7.00306545878646,7.82404601085629,7.54960916515453,7.54960916515453,7.3132203870903,8.1605182474775,7.20785987143248,7.60090245954208,7.0343879299155,7.68017564043659,6.80239476332431,7.60090245954208,7.13089883029635,7.82404601085629,6.85646198459459,6.30991827822652,7.3132203870903,8.00636756765025,7.17011954344963,7.87283617502572,6.74523634948436,8.00636756765025,7.69621263934641,7.9373746961633,7.24422751560335,7.24422751560335,6.5510803350434,8.06148686687133,7.13089883029635,7.24422751560335,6.47697236288968,6.74523634948436,7.24422751560335,7.37775890822787,6.74523634948436,7.43838353004431,7.3132203870903,7.60090245954208,6.68461172766793,7.69621263934641,8.07090608878782,6.62007320653036,7.17011954344963,7.52294091807237,8.33086361322474,8.41183267575841,7.09007683577609,7.43838353004431,7.07326971745971,7.3132203870903,6.85646198459459,7.60090245954208,7.20785987143248,6.90775527898214,7.20785987143248,6.86693328446188,7.37775890822787,8.85366542803745,6.80239476332431,7.00306545878646,6.39692965521615,6.68461172766793,7.00306545878646,8.1605182474775,7.09007683577609,6.80239476332431,6.85646198459459,7.52294091807237,6.94697599213542,7.54960916515453,7.13089883029635,7.17011954344963,6.74523634948436,7.60090245954208,6.74523634948436,7.43248380791712,7.09007683577609,7.7621706071382,6.90775527898214,7.17011954344963,7.20785987143248,6.90775527898214,7.09007683577609,7.00306545878646,6.50279004591562,8.20658361432075,8.10167774745457,7.60090245954208,7.40853056689463,7.99967857949945,7.09007683577609,7.34601020991329,7.3132203870903,7.40853056689463,7.00306545878646,7.34601020991329,6.85646198459459,7.62559507213245,7.27931883541462,6.85646198459459,6.47697236288968,7.24422751560335,7.3132203870903,7.20785987143248,6.90775527898214,7.40853056689463,7.09007683577609,8.80986280537906,7.43838353004431,8.1605182474775,6.85646198459459,6.80239476332431,7.69621263934641,7.24422751560335,8.74033674273045,7.17011954344963,6.68461172766793,7.60090245954208,7.37462901521894,7.29979736675816,7.34601020991329,7.39326309476384,6.47697236288968,7.13886699994552,6.80239476332431,8.26873183211774,6.80239476332431,7.3132203870903,7.03878354138854,7.24422751560335,6.47697236288968,6.5510803350434,8.69951474821019,8.00636756765025,6.39692965521615,6.90775527898214,6.90775527898214,7.60090245954208,6.80239476332431,6.74523634948436,6.80239476332431,7.78322401633604,7.17011954344963,7.17011954344963,8.33495163142245,6.85646198459459,6.77992190747225,6.68461172766793,7.24422751560335,8.1605182474775,7.13089883029635,8.59415423255237,7.82404601085629,7.40853056689463,7.41878088275079,7.9373746961633,7.00306545878646,8.29404964010203,7.60090245954208,8.29404964010203,7.34601020991329,7.34601020991329,7.09007683577609,7.74066440191724,7.46737106691756,7.62559507213245],null,null,{"interactive":true,"className":"","stroke":true,"color":["#35B779","#440154","#FDE725","#440154","#31688E","#FDE725","#FDE725","#FDE725","#FDE725","#440154","#808080","#FDE725","#440154","#440154","#440154","#440154","#808080","#FDE725","#440154","#31688E","#440154","#440154","#31688E","#440154","#31688E","#35B779","#31688E","#440154","#808080","#808080","#35B779","#440154","#440154","#808080","#35B779","#31688E","#FDE725","#31688E","#FDE725","#FDE725","#808080","#440154","#808080","#808080","#440154","#FDE725","#FDE725","#440154","#440154","#440154","#31688E","#31688E","#808080","#31688E","#31688E","#35B779","#31688E","#440154","#440154","#31688E","#808080","#FDE725","#440154","#FDE725","#808080","#35B779","#FDE725","#440154","#440154","#808080","#440154","#FDE725","#FDE725","#808080","#808080","#808080","#808080","#440154","#440154","#808080","#31688E","#440154","#31688E","#440154","#440154","#FDE725","#31688E","#31688E","#31688E","#FDE725","#440154","#35B779","#440154","#35B779","#808080","#35B779","#440154","#FDE725","#808080","#808080","#31688E","#FDE725","#440154","#FDE725","#808080","#FDE725","#35B779","#FDE725","#440154","#440154","#808080","#FDE725","#440154","#440154","#808080","#808080","#440154","#31688E","#808080","#31688E","#31688E","#35B779","#808080","#35B779","#FDE725","#808080","#440154","#31688E","#FDE725","#FDE725","#440154","#31688E","#440154","#31688E","#808080","#35B779","#440154","#440154","#440154","#808080","#31688E","#808080","#808080","#440154","#808080","#808080","#440154","#FDE725","#440154","#808080","#808080","#31688E","#440154","#31688E","#440154","#440154","#808080","#35B779","#808080","#31688E","#440154","#35B779","#440154","#440154","#440154","#440154","#440154","#440154","#808080","#FDE725","#FDE725","#35B779","#31688E","#FDE725","#440154","#31688E","#31688E","#31688E","#440154","#31688E","#808080","#35B779","#440154","#808080","#808080","#440154","#31688E","#440154","#440154","#31688E","#440154","#808080","#31688E","#FDE725","#808080","#808080","#35B779","#440154","#808080","#440154","#808080","#35B779","#31688E","#440154","#31688E","#31688E","#808080","#440154","#808080","#FDE725","#808080","#31688E","#440154","#440154","#808080","#808080","#808080","#FDE725","#808080","#440154","#440154","#35B779","#808080","#808080","#808080","#35B779","#440154","#440154","#FDE725","#808080","#808080","#808080","#440154","#FDE725","#440154","#808080","#FDE725","#31688E","#31688E","#FDE725","#440154","#FDE725","#35B779","#FDE725","#31688E","#31688E","#440154","#35B779","#31688E","#35B779"],"weight":10,"opacity":0.5,"fill":true,"fillColor":["#35B779","#440154","#FDE725","#440154","#31688E","#FDE725","#FDE725","#FDE725","#FDE725","#440154","#808080","#FDE725","#440154","#440154","#440154","#440154","#808080","#FDE725","#440154","#31688E","#440154","#440154","#31688E","#440154","#31688E","#35B779","#31688E","#440154","#808080","#808080","#35B779","#440154","#440154","#808080","#35B779","#31688E","#FDE725","#31688E","#FDE725","#FDE725","#808080","#440154","#808080","#808080","#440154","#FDE725","#FDE725","#440154","#440154","#440154","#31688E","#31688E","#808080","#31688E","#31688E","#35B779","#31688E","#440154","#440154","#31688E","#808080","#FDE725","#440154","#FDE725","#808080","#35B779","#FDE725","#440154","#440154","#808080","#440154","#FDE725","#FDE725","#808080","#808080","#808080","#808080","#440154","#440154","#808080","#31688E","#440154","#31688E","#440154","#440154","#FDE725","#31688E","#31688E","#31688E","#FDE725","#440154","#35B779","#440154","#35B779","#808080","#35B779","#440154","#FDE725","#808080","#808080","#31688E","#FDE725","#440154","#FDE725","#808080","#FDE725","#35B779","#FDE725","#440154","#440154","#808080","#FDE725","#440154","#440154","#808080","#808080","#440154","#31688E","#808080","#31688E","#31688E","#35B779","#808080","#35B779","#FDE725","#808080","#440154","#31688E","#FDE725","#FDE725","#440154","#31688E","#440154","#31688E","#808080","#35B779","#440154","#440154","#440154","#808080","#31688E","#808080","#808080","#440154","#808080","#808080","#440154","#FDE725","#440154","#808080","#808080","#31688E","#440154","#31688E","#440154","#440154","#808080","#35B779","#808080","#31688E","#440154","#35B779","#440154","#440154","#440154","#440154","#440154","#440154","#808080","#FDE725","#FDE725","#35B779","#31688E","#FDE725","#440154","#31688E","#31688E","#31688E","#440154","#31688E","#808080","#35B779","#440154","#808080","#808080","#440154","#31688E","#440154","#440154","#31688E","#440154","#808080","#31688E","#FDE725","#808080","#808080","#35B779","#440154","#808080","#440154","#808080","#35B779","#31688E","#440154","#31688E","#31688E","#808080","#440154","#808080","#FDE725","#808080","#31688E","#440154","#440154","#808080","#808080","#808080","#FDE725","#808080","#440154","#440154","#35B779","#808080","#808080","#808080","#35B779","#440154","#440154","#FDE725","#808080","#808080","#808080","#440154","#FDE725","#440154","#808080","#FDE725","#31688E","#31688E","#FDE725","#440154","#FDE725","#35B779","#FDE725","#31688E","#31688E","#440154","#35B779","#31688E","#35B779"],"fillOpacity":0.2},null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null,null]},{"method":"addLegend","args":[{"colors":["#440154","#31688E","#35B779","#FDE725"],"labels":["1,000 &ndash; 1,500","1,500 &ndash; 2,000","2,000 &ndash; 2,500","2,500 &ndash; 5,000"],"na_color":null,"na_label":"NA","opacity":0.5,"position":"bottomright","type":"bin","title":"Prices","extra":null,"layerId":null,"className":"info legend","group":null}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]}],"limits":{"lat":[45.4432,45.5036],"lng":[9.1442,9.23739]}},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 7.1: Leaflet Map
</p>
</div>
<p>Predictors, in this case latitude and longitude appear to have nonlinear relationships with the outcome price. The relationship appears to be Gaussian whose mean points to the city center, red dashed line represent latitude and longitude coordinates for the Dome of Milan. Non linearities can be treated with regression splines</p>
<div class="figure"><span id="fig:NonLinearSpatialRel"></span>
<img src="07-exploratory_files/figure-html/NonLinearSpatialRel-1.png" alt="Non Linear Spatial Relationship disclosed" width="672" />
<p class="caption">
Figure 7.2: Non Linear Spatial Relationship disclosed
</p>
</div>
<p>ggplot2 visualzitaion matt dancho inspiration::</p>
</div>
</div>
<div id="counts-and-first-orientations" class="section level2">
<h2><span class="header-section-number">7.2</span> Counts and First Orientations</h2>
<p>Arranged Counts for categorical columns can give a sense of the distribution of categories across the dataset suggesting also which predictor to include in the model. The visualization in figure <a href="exploratory.html#fig:fctCounts">7.3</a> offers the rearranged factor <em>TOTLOCALI</em>.
Bilocali are the most common option for rent, then trilocali comes after. The intuition behind suggests that Milan rental market is oriented to “lighter” accommodations in terms of space and squarefootage. This should comes natural since Milan is both a vivid study and working area, so short stayings are warmly welcomed.</p>
<div class="figure"><span id="fig:fctCounts"></span>
<img src="07-exploratory_files/figure-html/fctCounts-1.png" alt="Most common housedolds categories" width="672" />
<p class="caption">
Figure 7.3: Most common housedolds categories
</p>
</div>
<p>Two of the most requested features for comfort and livability in rents are the heating/cooling systems installed. Moreover rental market demand, regardless of the rent duration, strives for a ready-to-accomodate offer to meet clients needs. In this sense accomodation coming with the newest and most techonological systems are naturally preferred with respect the contrary.
x-axis in figure <a href="exploratory.html#fig:PricePerAc">7.4</a> represents log_10 price for both of the two plots. Logarithmic scale is needed to smooth distributions and the resulting price interpretation have to considered into relative percent changes. Furthermore factors are reordered with respect to decreasing price.<br />
y-axis are the different level for the categorical variables recoded from the original data due to simplify lables and to hold plot dimension. Moreover counts per level are expressed between brackets close to their respective factor.
The top plot displays the most prevalent heating systems categories, among which the most prevalent is “Cen_Rad_Met” by far. This fact is extremely important since metano is a green energy source and if the adoption is wide spread and pipelines are well organized than it brings enormous benefit to the city. As a consequence one major concern regards that for many years policies have been oriented to reduce vehicles emission (euro1 euro2…) instead of focusing on house emissions. This was also a consequence of the lack of house data especially in rural areas. According to data there are still a 15% portion of houses powered by oil fired.
Then in bottom plot Jittering is then applied to point out the number of outliers outside the IQR (Inter Quantile Range) .25 and their impact on the distribution. A first conclusion is that outliers are mainly located in autonomous systems, which leads of course to believe that the most expensive houses are heated by autonomoius heating systems. Indedd in any case this fact that does not affect monthly price. The overlapping IQR signifies that the covariates levels do not impact the response variable.</p>
<div class="figure"><span id="fig:PricePerAc"></span>
<img src="07-exploratory_files/figure-html/PricePerAc-1.png" alt="Log Monthly Price per Heating/Cooling system?" width="672" />
<p class="caption">
Figure 7.4: Log Monthly Price per Heating/Cooling system?
</p>
</div>
<p>this visualization intersects allows to discover bimodality in the response variable. Log scales was needed since they are all veru skewd and log scale then is needed also in the model.</p>
<p>(qui ci puoi mettere a confronto per variabile bianria, così vedi cosa includere nel modello esempio sotto dove commentato, )</p>
<p><img src="07-exploratory_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<p>What it might be really relevant to research is how monthly prices change with respect to house square footage for each house configuration. The idea is to asses how much adding a further square meter affetcs the monthly price for each n-roomed flat.
One implication is how the property should be developed in order to request a greater amount of money per month. As an example in a situation in which the household has to lot its property into different sub units he can be helped to decide the most proficient choice in economic terms by setting ex ante the square footage extensions for each of the sub-properties.
A further implication can regard economic convenience to enlarge new property acquisitions under the expectation to broadened the square footage (construction firms). Some of the potential enlargements are economically justified, some of the other are not.
The plot <a href="exploratory.html#fig:GlmPriceSq">7.5</a> has two continuous variables for x (price) and y (sqfeet) axis, the latter is log 10 scaled due to smoothness reasons. Coloration discretizes points for the each <span class="math inline">\(j\)</span> household rooms totlocali. A sort of overlapping piece-wise linear regression (log-linear due to transformation) is fitted on each totlocali group, whose response variable is price and whose only predictor is the square footage surface (i.e. <span class="math inline">\(\log_{10}(\mathbf{price_j}) \sim +\beta_{0,j}+\beta_{1,j}\mathbf{sqfeet_j}\)</span>). Five different regression models are proposed in the top left. The interesting part regards the models slopes <span class="math inline">\(\hat\beta_{1,j}\)</span>. The highest corresponds to “Monolocale” for which the enlargement of a 10 square meters in surface enriches the apartment of a 0.1819524% monthly price addition. Almost the same is witnessed in “Bilocale” for which a 10 square meters extension gains a 0.1194379% value. One more major thing to notice is the “ensamble” regression line obtained as the interpolation of the 5 plotted ones. The line suggests a clear slope descending pattern (logarithmic trend) from Pentalocale and beyond whose assumption is strengthened by looking at the decreasing trend in the <span class="math inline">\(\hat\beta_1\)</span> predictor slopes coefficients. Furthermore investing into an extension for “Quadrilocale” and “Trilocale” is <em>coeteris paribus</em> an interchangeable economic choice.</p>
<div class="figure"><span id="fig:GlmPriceSq"></span>
<img src="07-exploratory_files/figure-html/GlmPriceSq-1.png" alt="Monthly Prices change wrt square meters footage in different n-roomed apt" width="672" />
<p class="caption">
Figure 7.5: Monthly Prices change wrt square meters footage in different n-roomed apt
</p>
</div>
<p>In table (…) resides the answer to the question “which are the most profitable properties per month in terms of the price per square meter footage ratio”. The covariate floor together with the totpiani are not part of the model, indeed they can explain the importance and the height of the building justifying extraordinary prices. The first 4 observations are unsurprisingly “Bilocale”, the spatial column location, not a regressor, can lend a hand to acknowledge that the street addresses point to very central and popular zones. The zones are, first City Life, second Brera and third Moscova, proving that in modeling real estate rents the spatial component is fundamental , even more in Milan.</p>
<table>
<thead>
<tr>
<th style="text-align:left;">
location
</th>
<th style="text-align:left;">
totlocali
</th>
<th style="text-align:right;">
price
</th>
<th style="text-align:right;">
sqfeet
</th>
<th style="text-align:left;">
floor
</th>
<th style="text-align:left;">
totpiani
</th>
<th style="text-align:right;">
abs_price
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
viale cassiodoro 28
</td>
<td style="text-align:left;">
Bilocale
</td>
<td style="text-align:right;">
1750
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:left;">
9 piano
</td>
<td style="text-align:left;">
10 piani
</td>
<td style="text-align:right;">
58.33333
</td>
</tr>
<tr>
<td style="text-align:left;">
via della spiga 23
</td>
<td style="text-align:left;">
Bilocale
</td>
<td style="text-align:right;">
2750
</td>
<td style="text-align:right;">
55
</td>
<td style="text-align:left;">
2 piano
</td>
<td style="text-align:left;">
4 piani
</td>
<td style="text-align:right;">
50.00000
</td>
</tr>
<tr>
<td style="text-align:left;">
corso giuseppe garibaldi 95
</td>
<td style="text-align:left;">
Bilocale
</td>
<td style="text-align:right;">
2700
</td>
<td style="text-align:right;">
56
</td>
<td style="text-align:left;">
2 piano
</td>
<td style="text-align:left;">
5 piani
</td>
<td style="text-align:right;">
48.21429
</td>
</tr>
<tr>
<td style="text-align:left;">
piazza san babila C.A.
</td>
<td style="text-align:left;">
Bilocale
</td>
<td style="text-align:right;">
1833
</td>
<td style="text-align:right;">
42
</td>
<td style="text-align:left;">
4 piano
</td>
<td style="text-align:left;">
4 piani
</td>
<td style="text-align:right;">
43.64286
</td>
</tr>
<tr>
<td style="text-align:left;">
ottimo stato piano terra, C.A.
</td>
<td style="text-align:left;">
Trilocale
</td>
<td style="text-align:right;">
3000
</td>
<td style="text-align:right;">
80
</td>
<td style="text-align:left;">
Piano terra
</td>
<td style="text-align:left;">
3 piani
</td>
<td style="text-align:right;">
37.50000
</td>
</tr>
<tr>
<td style="text-align:left;">
via federico confalonieri 5
</td>
<td style="text-align:left;">
Monolocale
</td>
<td style="text-align:right;">
750
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:left;">
1 piano
</td>
<td style="text-align:left;">
3 piani
</td>
<td style="text-align:right;">
37.50000
</td>
</tr>
</tbody>
</table>
<p>Then as a further point it might be important to investigate a linear model whose response is price and whose covariates are the newly created abs_price and some other presumably important ones e.g. floor, bagno, totpiani. The model fitted is <code>log2(price) ~ log2(abs_price) + bagno + floor + totpiani</code>.
The plot in figure <a href="exploratory.html#fig:TieFighterPlot">7.6</a> has the purpose to demonstrate how monthly price is affected by covariates conditioned to their respective square meter footage. The interpretation of the plot starts by fixing a focus point on 0, which is the null effect highlighted by the red dashed line. Then the second focus is on house surface effect (i.e. House Surface (doubling) in the plot, the term log2(abs_price) has been converted to more familiar House Surface (doubling)), which contributes to increase the price of an estimated coefficient of <span class="math inline">\(\approx .6\)</span> for each doubling of the square meter footage. Then what it can be noticed with respect to the two focus points are the unusual effects provoked by the other predictors t the right of the house surface effect and to the far left below 0. “2 and 3 bagni” are unusually expensive with respect to the square meter footage increment, on the other hand" al piano rialzato" and “al piano terra” are undervalued with respect to their surface. The fact that 2 and 3 bathrooms can guarantee a monthly extra check is probably caused to a minimum rent plateau requested for each occupant. the number of bathrooms are a proxy to both house extension since normally for each sleeping room there also exist at least 1 bathroom as well as prestigious houses dispose of more than 1 toilette services. So the more are the occupants regardless of the square meter footage dedicated to them, the more the house monthly returns,</p>
<p>it can be noticed is that ultimo piano, otgether with 2 abagni ad 3 bagni are unusually expensive with respect to their proper square meter footage. On the other hand the piano rialzato and piano terra are unusually undervalued given their surface.<br />
In other words the to help with the interpretation. The fact that 2 and 3 bathrooms can guarantee a monthly extra check is probably caused to a minimum rent plateau requested for each occupant. So the more are the occupants regardless of the square meter footage dedicated to them, the more the house returns. The conclusion</p>
<div class="figure"><span id="fig:TieFighterPlot"></span>
<img src="07-exploratory_files/figure-html/TieFighterPlot-1.png" alt="Coefficient Tie fighter plot for the linear model: log2(price) ~ log2(abs_price) + condom + other_colors" width="672" />
<p class="caption">
Figure 7.6: Coefficient Tie fighter plot for the linear model: log2(price) ~ log2(abs_price) + condom + other_colors
</p>
</div>
</div>
<div id="text-mining-in-estate-review" class="section level2">
<h2><span class="header-section-number">7.3</span> Text Mining in estate Review</h2>
<p>The word network in figure (fig:WordNetworkgraph) tries to summarize relevant information from real estate agency review into each advertisement. avg_totprice expresses the sum of the price per month plus the condominium in order to fully integrate inner property characteristics together with building exclusivity. Tokenized words are then filtered with “stopwords-iso” italian dictionary.
Nodes associated with hotter colours are also associated to more expensive in and out-house characteristics. The size of nodes keeps track of the number of reviews in which the specific word appears. A table of the most common words can help highlight both the real estate jargon as well as words that brings up house values.</p>
<table>
<thead>
<tr>
<th style="text-align:left;">
word
</th>
<th style="text-align:right;">
count
</th>
<th style="text-align:right;">
reviews
</th>
<th style="text-align:right;">
avg_totprice
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
bagno
</td>
<td style="text-align:right;">
249
</td>
<td style="text-align:right;">
192
</td>
<td style="text-align:right;">
1888.622
</td>
</tr>
<tr>
<td style="text-align:left;">
cucina
</td>
<td style="text-align:right;">
247
</td>
<td style="text-align:right;">
190
</td>
<td style="text-align:right;">
2088.814
</td>
</tr>
<tr>
<td style="text-align:left;">
ingresso
</td>
<td style="text-align:right;">
194
</td>
<td style="text-align:right;">
173
</td>
<td style="text-align:right;">
1964.062
</td>
</tr>
<tr>
<td style="text-align:left;">
soggiorno
</td>
<td style="text-align:right;">
182
</td>
<td style="text-align:right;">
159
</td>
<td style="text-align:right;">
1872.500
</td>
</tr>
<tr>
<td style="text-align:left;">
camera
</td>
<td style="text-align:right;">
200
</td>
<td style="text-align:right;">
158
</td>
<td style="text-align:right;">
1936.945
</td>
</tr>
<tr>
<td style="text-align:left;">
piano
</td>
<td style="text-align:right;">
197
</td>
<td style="text-align:right;">
157
</td>
<td style="text-align:right;">
1982.234
</td>
</tr>
<tr>
<td style="text-align:left;">
arredato
</td>
<td style="text-align:right;">
184
</td>
<td style="text-align:right;">
152
</td>
<td style="text-align:right;">
1744.614
</td>
</tr>
<tr>
<td style="text-align:left;">
composto
</td>
<td style="text-align:right;">
158
</td>
<td style="text-align:right;">
146
</td>
<td style="text-align:right;">
1758.911
</td>
</tr>
<tr>
<td style="text-align:left;">
riscaldamento
</td>
<td style="text-align:right;">
171
</td>
<td style="text-align:right;">
144
</td>
<td style="text-align:right;">
1877.404
</td>
</tr>
<tr>
<td style="text-align:left;">
zona
</td>
<td style="text-align:right;">
282
</td>
<td style="text-align:right;">
139
</td>
<td style="text-align:right;">
1930.213
</td>
</tr>
</tbody>
</table>
<p>Furthermore it is possible to grossly divide the plot in figure (fig:WordNetworkgraph) into 3 sub-groups of nodes, each of which addresses a specific part of the house comprehensive evaluation.
In the far right side of the plot are considered the external appliances like neighbor stores, subway stations and services and are associated to mean prices. The correspondent number of reviews are not justifying by any type of price increasing effect. Whereas slightly moving the view to the left, the area centered in portineria evidences a sub-groups of nodes associated to relatively higher avg-totprice. Some of them are servizio signorile palazzo. The previous set of nodes indicates services that are proper to the building can lead to some sort of extra payment. Then still moving
Possiamo immaginare di dividere il network in 3 raggruppamenti di nodi, ognuno dei quali parla di uni specifico tema. nella parte alta sinistra csi parla delle circostanze estenre dell’appartamente, i negozi i mezzi serizi la metri, i prezzi evidenzziati dal colore nei nodi sono neutri, indicando che non impattano il prezzo in maniera significativa. poco più sotto è possibile vedere un altro centroide verso il quale puntano una serie di edges peritenti che riguardano i servizi interni al building come la portinerua, l’ingresso, il palazzo. in questo caso i colori sono più caldi e i servizi sembrano essere pagati di più. successivamente sosptandoci veros il centro del’network si nota un nodo di gravità attorno alquale si trovamo molti outgoing edges, che riscaldamento. Attorno a riscaldamento che vista la grandezza ricorre spesso nelle recensioni, si sviluppano tutti i servizi non descritti da immobiliare all’interno della casa, insiema a tutte le caratteristiche cbe distinguono la casa revisionata dalle altre. i colori degradano spostandosi da sinistra verso destea, accanto a riscaldmaento si nota un cluster che associati a prezzi minoro come spese condominiali e arredato arredato. nel caso delle spese condominiali i cluster sono associati a prezzi minori perchè il prezzo del conominio spesso non è commisurato al prezzo nè al prestigio dell’appartamento. Speso infatti include costi variabili come utenze gas e luce, o acqua che vengono scontati con prezzi più bassi di affitto. la somma di condominio e prezzo offrirebbe un panorama più chiaro.</p>
<div class="figure"><span id="fig:WordNetworkgraph"></span>
<img src="07-exploratory_files/figure-html/WordNetworkgraph-1.png" alt="Word Network Graph for 250 Estate Agencies Review" width="672" />
<p class="caption">
Figure 7.7: Word Network Graph for 250 Estate Agencies Review
</p>
</div>
</div>
<div id="missing-assessement-and-imputation" class="section level2">
<h2><span class="header-section-number">7.4</span> Missing Assessement and Imputation</h2>
<p>As already pointed out some data might be lost since immobiliare provides the information that in turn are pre filled by estate agencies or privates through standard document formats. Some of the missing can be reverse engineered by other information in the web pages e.g. given the street address it is possible to trace back the lat and long coordinates. Some other information can be encountered in .json files hidden inside each of the single web pages.
The approach followed in this part is to prune redundant data and rare predictors trying to limit the dimensionality of the dataset.</p>
<div id="missing-assessement" class="section level3">
<h3><span class="header-section-number">7.4.1</span> Missing assessement</h3>
<p>The first problem to assess is why information are missing. As already pointed out in the preliminary part as well as in section <a href="scraping.html#ContentArchitecture"><strong>??</strong></a> many of the presumably important covariates (i.e. price lat, long, title ,id …) undergo to a sequence of forced step inside scraping functions with the aim to avoid to be lost. If at the end of the sequence covariates are still missing, the correspondent observation is not considered and it is left out of the resulting scraped dataset. The choice originates from empirical missing patterns suggesting that when important information are missing then the rest of the covariates are more likely to be missing to, as a consequence the observation should be discarded.
The missing profile is crucial since it can also raise suspicion on the scraping failures. By Taking advantage of the missing pattern in observations the maintainer can directly identify the problem and derivatives and immediately debug the error. In order to identify if the nature of the pattern a revision of missing and randomness is introduced by <span class="citation">Little and Rubin (<a href="#ref-Little" role="doc-biblioref">2014</a>)</span>.
Missing can be devided into 3 categories:</p>
<ul>
<li><em>MCAR</em> (missing completely at random) likelihood of missing is equal for all the information, in other words missing data are one idependetn for the other.</li>
<li><em>MAR</em> (missing at random) likelihood of missing is not equal.</li>
<li><em>NMAR</em> (not missing at random) data that is missing due to a specific cause, scarping can be the cause.</li>
</ul>
<p>MNAR is often the case of daily monitoring clinical studies <span class="citation">(Kuhn and Johnson <a href="#ref-Kuhn" role="doc-biblioref">2019</a>)</span>, where patient might drop out the experiment because of death and so all the relating data starting from the death time +1 are lost.
To identify the pattern a <em>heat map</em> plot <a href="exploratory.html#fig:Heatmap">7.8</a> clarifies the idea:</p>
<div class="figure"><span id="fig:Heatmap"></span>
<img src="07-exploratory_files/figure-html/Heatmap-1.png" alt="Missingness Heatmap plot" width="672" />
<p class="caption">
Figure 7.8: Missingness Heatmap plot
</p>
</div>
<p>Looking at the top of the heat map plot, right under the “Predictor” label, the first tree split divides predictors into two sub-groups. The left branch considers from <em>TOTPIANI</em> to <em>CATASTINFO</em> and there are no evident patterns. Then missingness can be traced back to MAR. Imputation needs to be applied up to <em>CONDOM</em> included, the others are discarded due to rarity: i.e. <em>BUILDAGE</em>: 14% missing, <em>CATASTINFO</em>: 21% and <em>AC</em>: 24%. Moreover <em>CUCINA</em> and <em>ALTRO</em> are generated as “childred” of the original <em>LOCALI</em> variable, so it should not surprise that their missing behavior is similar ,whose prevalence is respectively 13% and 14%, for that reason are discarded.
In the far right hand side <em>ENCLASS</em> and <em>DISP</em> data are completely missing and a pattern seems to be found. The most obvious reason is a scraping fail in capturing data. Further inspection of the API scraping functions focused on the two covariates is strongly advised. From <em>LOWRDPRICE.</em> covariates gorup class it seems to be witnessing a missing underlining pattern NMAR which is clearer by looking at the co_occurrence plot in figure <a href="exploratory.html#fig:cooccurrence">7.9</a>. Co-occurrence analysis might suggest frequency of missing predictor in combination and <em>LOWRDPRICE.</em> class covariates are displaying this type of behavior. <em>PAUTO</em> is missing in the place where <em>LOWRDPRICE.</em> class covariates are missing, but this is not happening for the opposite, leading to the conclusion that <em>PAUTO</em> should be treated as a rare covariate MAR, therefore <em>PAUTO</em> is dropped.
After some further investigation on <em>LOWRDPRICE.</em>, the group class flags when the <em>PRICE</em> covariate is effectively decreased and this is unusual. That is solved by grouping the covariate’s information and to encode it as a two levels categorical covariate if lowered or not. Further methods to feature engineer the <em>LOWRDPRICE.</em> class covariates can be with techniques typical of profile data, further references are on <span class="citation">Kuhn and Johnson (<a href="#ref-Kuhn" role="doc-biblioref">2019</a>)</span>.</p>
<div class="figure"><span id="fig:cooccurrence"></span>
<img src="07-exploratory_files/figure-html/cooccurrence-1.png" alt="Missingness co-occurrence plot" width="672" />
<p class="caption">
Figure 7.9: Missingness co-occurrence plot
</p>
</div>
</div>
<div id="covariates-imputation" class="section level3">
<h3><span class="header-section-number">7.4.2</span> Covariates Imputation</h3>
<p>A relatively simple approach to front missingness is to build a regression model to explain the covariates that have some missing and plug-back-in the respective estimates (e.g. posterior means) from their predictive distributions <span class="citation">Little and Rubin (<a href="#ref-Little" role="doc-biblioref">2014</a>)</span>. This approach is fast and easy to implement in most of the cases, but it ignores the uncertainty behind the imputed values <span class="citation">(Gómez Rubio <a href="#ref-Bayesian_INLA_Rubio" role="doc-biblioref">2020</a>)</span>. However it has the benefit to be a more than a reasonable choice with respect to the number of computation required, especially with INLA and in a spatial setting. That makes it the first choice method to follow since imputation regards also a small portion of data and predictors. At first it is considered the predictor <em>condominium</em> for which some observation are missing. Indices are:</p>
<pre><code>##  [1]  19  74  77  90  99 113 116 120 179 249</code></pre>
<!-- and a benchmark model is fitted whose formula is `price ~ 1 + condom + bagno + sqfeet`. Inla handles missing data by ignoring them so the model trains coefficients on a restricted sample of observations. -->
<!-- ```{r} -->
<!-- ## benchmark model -->
<!-- benchmark = inla(price ~ 1+ condom + totlocali + sqfeet, data = data_miss) -->
<!-- benchmark$summary.fixed %>%  -->
<!--   rownames_to_column(var = "terms") %>%  -->
<!--   as_tibble() %>%  -->
<!--   select(terms:sd) %>%  -->
<!--   column_to_rownames(var = "terms")  %>% -->
<!--   head(6) %>%  -->
<!--   knitr::kable(booktabs = T) -->
<!-- ``` -->
<p>A model is fitted based on missing data for which the response var is condominium and predictors are other important explanatory ones, i.e.<code>condom ~ 1 + sqfeet + totlocali + floor + heating + ascensore</code>. In addition to the formula in the inla function a further specification has to be provided with the command <code>compute = TRUE</code> in the argument control.predictor. The command <code>compute</code> estimates the posterior means of the predictive distribution in the response variable for the missing points. The estimated posetior mean quantities are then imputeda are in table @red(tab:CondomImputation)</p>
<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
fitted.Predictor.019
</td>
<td style="text-align:right;">
198.11095
</td>
<td style="text-align:right;">
19.67085
</td>
</tr>
<tr>
<td style="text-align:left;">
fitted.Predictor.074
</td>
<td style="text-align:right;">
162.96544
</td>
<td style="text-align:right;">
13.29456
</td>
</tr>
<tr>
<td style="text-align:left;">
fitted.Predictor.077
</td>
<td style="text-align:right;">
99.38197
</td>
<td style="text-align:right;">
32.34108
</td>
</tr>
<tr>
<td style="text-align:left;">
fitted.Predictor.090
</td>
<td style="text-align:right;">
331.73519
</td>
<td style="text-align:right;">
33.05035
</td>
</tr>
<tr>
<td style="text-align:left;">
fitted.Predictor.099
</td>
<td style="text-align:right;">
170.54068
</td>
<td style="text-align:right;">
12.30267
</td>
</tr>
<tr>
<td style="text-align:left;">
fitted.Predictor.113
</td>
<td style="text-align:right;">
196.61593
</td>
<td style="text-align:right;">
15.86545
</td>
</tr>
<tr>
<td style="text-align:left;">
fitted.Predictor.116
</td>
<td style="text-align:right;">
108.40482
</td>
<td style="text-align:right;">
20.79689
</td>
</tr>
<tr>
<td style="text-align:left;">
fitted.Predictor.120
</td>
<td style="text-align:right;">
162.86977
</td>
<td style="text-align:right;">
25.61622
</td>
</tr>
<tr>
<td style="text-align:left;">
fitted.Predictor.179
</td>
<td style="text-align:right;">
165.03632
</td>
<td style="text-align:right;">
20.53485
</td>
</tr>
<tr>
<td style="text-align:left;">
fitted.Predictor.249
</td>
<td style="text-align:right;">
117.24234
</td>
<td style="text-align:right;">
30.80290
</td>
</tr>
</tbody>
</table>
<!-- Afterwards the benchmark model is refitted in imputed data and coefficients are compared with the missing. Results displays... -->
<!-- ```{r refitting} -->
<!-- data_imputed = data.frame(data_miss) -->
<!-- data_imputed$condom[condom_na] = cov_imputation$summary.fitted.values[condom_na, "mean"] -->
<!-- which(is.na(data_imputed$condom)) -->
<!-- refitted = inla(price ~ 1 + condom + totlocali+ sqfeet, data = data_imputed) -->
<!-- refitted %>%  summary() -->
<!--   rownames_to_column(var = "terms") %>%  -->
<!--   as_tibble() %>%  -->
<!--   select(terms:sd) %>%  -->
<!--   column_to_rownames(var = "terms")  %>% -->
<!--   head(6) %>%  -->
<!--   knitr::kable(booktabs = T) -->
<!-- ``` -->
<p>A further method for imputation has been designed by <em>Gómez-Rubio, Cameletti, and Blangiardo 2019) miss lit</em> by adding a sub-model for the imputations to the final model through the inla function. This is directly handled inside the predictor formula adding a parameter in the latent field. However the approach makes the model more complex with a further layer of uncertainty to handle.
At first the additive regression model with all the covariates is called including the covariates with missing values. The response variable <em>PRICE</em> displays no missing values and the model fitted is:</p>
</div>
</div>
<div id="model-specification" class="section level2">
<h2><span class="header-section-number">7.5</span> Model Specification</h2>
</div>
<div id="mesh-building" class="section level2">
<h2><span class="header-section-number">7.6</span> Mesh building</h2>
<p><em>PARAFRASARE</em>
The SPDE approach approximates the continuous Gaussian field <span class="math inline">\(w_{i}\)</span> as a discrete Gaussian Markov random field by means of a finite basis function defined on a triangulated mesh of the region of study. The spatial surface can be interpolated performing this approximation with the inla.mesh.2d() function of the R-INLA package. This function creates a Constrained Refined Delaunay Triangulation (CRDT) over the study region, that will be simply referred to as the mesh. Mesh should be intended as a trade off between the accuracy of the GMRF surface representation and the computational cost, in other words the more are the vertices, the finer is the GF approximation, leading to a computational funnel.</p>
<div class="figure">
<img src="images/triangle.jpg" alt="" />
<p class="caption">Traingularization intuition, <span class="citation">Krainski (<a href="#ref-Krainski-Rubio" role="doc-biblioref">2019</a>)</span> source</p>
</div>
<p>Arguments can tune triangularization through inla.mesh.2d() :</p>
<ul>
<li><code>loc</code>:location coordinates that are used as initial mesh vertices</li>
<li><code>boundary</code>:object describing the boundary of the domain,</li>
<li><code>offset</code>: argument is a numeric value (or a length two vector) and it is used
to set the automatic extension distance. If positive, it is the extension distance
in the same scale units. If negative, it is interpreted as a factor relative to the
approximate data diameter; i.e., a value of -0.10 (the default) will add a 10%
of the data diameter as outer extension.</li>
<li><code>cutoff</code>: points at a closer distance than the supplied value are replaced by a single vertex. Hence, it avoids small triangles</li>
<li><code>max.edge</code>: A good mesh needs to have triangles as regular as possible in size and shape.</li>
<li><code>min.angle</code>argument (which can be scalar or length two vector) can be used to specify the minimum internal angles of the triangles in the inner domain and the outer extension</li>
</ul>
<p>A convex hull is a polygon of triangles out of the domain area, in other words the extension made to avoid the boundary effect. All meshes in Figure 2.12 have been made to have a convex hull boundary. If borders are available are generally preferred, so non convex hull meshes are avoided.</p>
<div id="shinyapp-for-mesh-assessment" class="section level3">
<h3><span class="header-section-number">7.6.1</span> Shinyapp for mesh assessment</h3>
<p>INLA includes a Shiny (Chang et al., 2018) application that can be used to tune the mesh params interactively</p>
<p>The mesh builder has a number of options to define the mesh on the left side. These include options to be passed to functions inla.nonconvex.hull() and inla.mesh.2d() and the resulting mesh displayed on the right part.</p>
</div>
<div id="building-spde-model-on-mesh" class="section level3">
<h3><span class="header-section-number">7.6.2</span> BUilding SPDE model on mesh</h3>
</div>
</div>
<div id="spatial-kriging-prediction" class="section level2">
<h2><span class="header-section-number">7.7</span> Spatial Kriging (Prediction)</h2>
<p>QUI INCERTEZZE</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-Bayesian_INLA_Rubio">
<p>Gómez Rubio, Virgilio. 2020. <em>Bayesian Inference with Inla</em>. Chapman; Hall/CRC. <a href="https://doi.org/10.1201/9781315175584">https://doi.org/10.1201/9781315175584</a>.</p>
</div>
<div id="ref-Krainski-Rubio">
<p>Krainski, Elias T. 2019. <em>Advanced Spatial Modeling with Stochastic Partial Differential Equations Using R and Inla</em>. Chapman; Hall/CRC.</p>
</div>
<div id="ref-Kuhn">
<p>Kuhn, Max, and Kjell Johnson. 2019. <em>Feature Engineering and Selection</em>. Chapman; Hall/CRC. <a href="https://doi.org/10.1201/9781315108230">https://doi.org/10.1201/9781315108230</a>.</p>
</div>
<div id="ref-Little">
<p>Little, Roderick, and Donald Rubin. 2014. “Statistical Analysis with Missing Data, Second Edition.” In, 200–220. <a href="https://doi.org/10.1002/9781119013563.ch10">https://doi.org/10.1002/9781119013563.ch10</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="spde.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="modelspec.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": true,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin"],
"google": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/NiccoloSalvini/thesis/edit/master/07-exploratory.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Niccolo_Salvini_Thesis.pdf"],
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"search": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
