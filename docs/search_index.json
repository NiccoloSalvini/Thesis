[["exploratory.html", "Chapter 6 Exploratory Analysis 6.1 Data Preprocessing 6.2 Maps and Geo-Visualisations 6.3 Counts and First Orientations 6.4 Text Mining in estate Review 6.5 Missing Assessement and Imputation", " Chapter 6 Exploratory Analysis Data emerging from the RESTful API body response is not in its tidiest format regardless of the query arguments sent. Yet data undergoes to a series of pre-processing step during scraping, which still requires to clear up unnecessary character and to separate columns containing more than one covariate. To the analysis extent data should be reproducible in the sense that it should be constrained to the same geographic area otherwise the analysis would not be either comparable nor reproducible. As a result RESTful API parameters calls are kept permanent by passing to the API the .thesis parameter, section 3.1.5. In other words the (mandatory) argument option secures to specify to the API an already composed url to be passed to the scraping endpoint. The composed url corresponds to the properties contained in zones within the Municipality of Milan borders. From a more practical point of view the operation is the equivalent to refresh each time the same immobiliare.it web page for which filters are always the same. A further parameter npages is set equal to 10, leading to to a total of 250 data points. A summary table of the columns involved in the analysis is presented with the goal to familiarize with incoming API data. Data already enters semi-preprocessed, but due to API smoothness reasons it still needs some processing, treated in6.1. Data gathered from the second /completescrape endpoint contains geo-statistical components and consequently a map representation of Real Estate rental maket at the gitbook building time i.e. (2021-01-21 ) is given. A further plot assess spatial dependence highlighting that coordinates are non-linearly related 6.1 to the y-response monthlyprice variable. Exploration starts with factor counts evidencing a Bilocale prevalence. This implies some critical Milan real estate market demand information and consequently reflections on the offer. Data displays bimodality in prices distribution for different n-roomed accommodations and the model should take account of the behavior. Then a piece-wise linear regression is fitted for each household type accommodation factor, whose single predictor is the square meter footage. The analysis emphasize some valuable economic consequences both for investors interested into property expansions and for tenants that are planning to partition single properties into rentable sub-units. The previous analysis brings along a major question which addresses the most valuable properties per single square meter surface and an answer based on data is given. Then a log-linear model is fitted on some presumably important covariates to evaluate each single house characteristic contribution to the price. A Tie Fighter plot displays for which coefficient, associated to each dummy predictor, surprisingly high monthly prices compared to the effect of the square meter footage expansion. A partial conclusion is that disposing of 2 or 3 bathrooms truly pays back an extra monthly return, also due to the number of tentants the accomodations could host. Text mining techniques are applied on real estate agency reviews and a network graph can help to distinguish topics. Then Missing assessement and imputation takes place. At first is made a brief a revision on randomness in missing by Little and Rubin (2014) which may help to figure out if data is missing due to API failures or for other reasons. Theory is applied by visualizing missingness in combination with heat-map and co-occurrence plot. Combined missing observation test is able to detect whether data is missing because of inner scraping faiilures or simple low prevalence in appereance. Then for each of the covariate that pass the exam, then imputation is made through INLA posterior expectation. This is the case of missing data in predictors, so the missing covariates ( condominium ) are brought into a model as response variable where this time predictors are the explanatory ones. Through a method specified within the INLA function the posterior statistics are computed and then finally imputed in the place of missing ones. prova a farla in latex e aggiungere covariate nuove su dataset pi√π grande* name ref ID ID of the apartements LAT latitude coordinate LONG longitude coordinate LOCATION the complete address: street name and number CONDOM the condominium monthly expenses BUILDAGE the age in which the building was contructed FLOOR the property floor INDIVSAPT indipendent property type versus apartement type LOCALI specification of the type and number of rooms TPPROP property type residential or not STATUS the actual status of the house, ristrutturato, nuovo, abitabile HEATING the heating system Cen_Rad_Gas (centralizzato a radiatori, alim a gas), Cen_Rad_Met, AC air conditioning hot and cold, Autonomo, freddo/caldo, Centralizzato, freddo/caldo PUB_DATE the date of publication of the advertisement CATASTINFO land registry information APTCHAR apartement main characteristics PHOTOSNUM number of photos displayed in the advertisement AGE real estate agency name LOWRDPRICE_ORIGINAL_PRICE If the price is lowered it flags the starting price LOWRDPRICE_CURRENT_PRICE If the price is lowered it flags the current price LOWRDPRICE_PASSED_DAYS If the price is lowered indicates the days passed since the price has changed LOWRDPRICE_DATE If the price is lowered indicates the date the price has changed ENCLASS the energy class according to the land registers CONTR the type of contract DISP if it is still avaiable or already rented TOTPIANI the total number of the building floors PAUTO number of parking box or garages avaibable in the property REVIEW estate agency review, long chr string HASMULTI it if has multimedia option, such as 3D house vitualization home experience or videos PRICE the monthly price &lt;- response SQFEET square meters footage NROOM the number of rooms in the house, and their types TITLE title of published advertisement 6.1 Data Preprocessing Data needs to undergo to many previous cleaning preprocess steps, which mainly regard separating columns and extracting relevant covariates. This is a forced stage since for the way the API is designed it tries several searches (refer to fig. ??) for the data demanded. Chances are that information may be found into a hidden json object (this is true fot Latitude and Longitude) which needs some heavy wrangling. Steps followed are: floors covariate needs to be separated in its ascensore and accdisabili components, adding 2 more bivariate covariates. locali needs to be separated too. 5 category levels drain out: totlocali, camereletto, altro, bagno, cucina. nroom is a duplicate for totlocali, so it is discarded. aptchar is a character string column that contains a non fixed number of features per house. The preprocess steps include cleaning the string from unnecessary characters, finding the set of unique elements across the character column (regex pattern), separating each feature in its proper column, in the end recoding newly created bivariate columns as yes or no according to a matching pattern. 6.2 Maps and Geo-Visualisations Geographic coordinates can be represented on a map in order to reveal first symptoms of spatial autocorrelation. Observations are spread almost equally throughout the surface even though the response price indicates unsurprisingly that higher prices are located near to the city center. The map in figure @ref(fig:leaflet_visuals) is a leaflet object, which needs to be overlapped with layers indicating different maps projections. This is interactive in the .html version, and static is proposed in the .pdf output version. The map object takes a input the latitute and longitude coordinates coming from THE API, and they do not need any CRS (Coordinate Reference System) projection since leaflet can accept the data type. Predictors, in this case latitude and longitude appear to have nonlinear relationships with the outcome price. The relationship appears to be Gaussian whose mean points to the city center, red dashed line represent latitude and longitude coordinates for the Dome of Milan. Non linearities can be treated with regression splines Figure 6.1: Non Linear Spatial Relationship disclosed ggplot2 visualzitaion matt dancho inspiration:: 6.3 Counts and First Orientations Arranged Counts for categorical columns can give a sense of the distribution of categories across the dataset suggesting also which predictor to include in the model. The visualization in figure 6.2 offers the rearranged factor TOTLOCALI. Bilocali are the most common option for rent, then trilocali comes after. The intuition behind suggests that Milan rental market is oriented to lighter accommodations in terms of space and squarefootage. This should comes natural since Milan is both a vivid study and working area, so short stayings are warmly welcomed. Figure 6.2: Count plot for each housedolds category Two of the most requested features for comfort and livability in rents are the heating/cooling systems. Moreover rental market demand, regardless of the rent duration, strives for a ready-to-accomodate offer to meet clients expectation. In this sense accommodation coming with the newest and the most technologically advanced systems are naturally preferred. x-axis in figure 6.3 represents \\(\\log_{10}\\) price for both of the upper and lower panel. Logarithmic scale is needed to smooth distributions and the resulting price interpretation have to considered into relative percent changes. Furthermore factors are reordered with respect to decreasing price. y-axis are the different level for the categorical variables recoded from the original data due to simplify lables and to hold plot dimension. Moreover counts per level are expressed between brackets close to their respective factor. The top plot displays the most prevalent heating systems categories, among which the most prevalent is Cen_Rad_Met by far. This fact is extremely important since metano is a green energy source and if the adoption is wide spread and pipelines are well organized than it brings enormous benefit to the city. As a consequence one major concern regards that for many years policies have been oriented to reduce vehicles emission (euro1 euro2) instead of focusing on house emissions. This was also a consequence of the lack of house data especially in rural areas. According to data there are still a 15% portion of houses powered by oil fired. Then in bottom plot Jittering is then applied to point out the number of outliers outside the IQR (Inter Quantile Range) .25 and their impact on the distribution. A first conclusion is that outliers are mainly located in autonomous systems, which leads of course to believe that the most expensive houses are heated by autonomoius heating systems. Indedd in any case this fact that does not affect monthly price. The overlapping IQR signifies that the covariates levels do not impact the response variable. Figure 6.3: Log Monthly Prices box-plots for the most common factor levels in Heating systems and Air Conditionings VALE LA PENA GUARDARE QUELLE CHE SI SONO ABBASSATE DI PREZZO E DOVE SONO e magari desumere il perch√® (magari vedere che sono pi√π a stundente che a non studente) &gt; questo implica fare unanalisi di covid il che √® buono perch√®√® p√® unanalisi bella fresca What it might be really relevant to research is how monthly prices change with respect to house square footage for each house configuration. The idea is to asses how much adding a further square meter affetcs the monthly price for each n-roomed flat. One implication is how the property should be developed in order to request a greater amount of money per month. As an example in a situation in which the household has to lot its property into different sub units he can be helped to decide the most proficient choice in economic terms by setting ex ante the square footage extensions for each of the sub-properties. A further implication can regard economic convenience to enlarge new property acquisitions under the expectation to broadened the square footage (construction firms). Some of the potential enlargements are economically justified, some of the other are not. The plot 6.4 has two continuous variables for x (price) and y (sqfeet) axis, the latter is log 10 scaled due to smoothness reasons. Coloration discretizes points for the each \\(j\\) household rooms totlocali. A sort of overlapping piece-wise linear regression (log-linear due to transformation) is fitted on each totlocali group, whose response variable is price and whose only predictor is the square footage surface (i.e. \\(\\log_{10}(\\mathbf{price_j}) \\sim +\\beta_{0,j}+\\beta_{1,j}\\mathbf{sqfeet_j}\\)). Five different regression models are proposed in the top left. The interesting part regards the models slopes \\(\\hat\\beta_{1,j}\\). The highest corresponds to Monolocale for which the enlargement of a 10 square meters in surface enriches the apartment of a 0.1819524% monthly price addition. Almost the same is witnessed in Bilocale for which a 10 square meters extension gains a 0.1194379% value. One more major thing to notice is the ensamble regression line obtained as the interpolation of the 5 plotted ones. The line suggests a clear slope descending pattern (logarithmic trend) from Pentalocale and beyond whose assumption is strengthened by looking at the decreasing trend in the \\(\\hat\\beta_1\\) predictor slopes coefficients. Furthermore investing into an extension for Quadrilocale and Trilocale is coeteris paribus an interchangeable economic choice. Figure 6.4: Monthly Prices change wrt square meters footage in different n-roomed apt In table () resides the answer to the question which are the most profitable properties per month in terms of the price per square meter footage ratio. The covariate floor together with the totpiani are not part of the model, indeed they can explain the importance and the height of the building justifying extraordinary prices. The first 4 observations are unsurprisingly Bilocale, the spatial column location, not a regressor, can lend a hand to acknowledge that the street addresses point to very central and popular zones. The zones are, first City Life, second Brera and third Moscova, proving that in modeling real estate rents the spatial component is fundamental , even more in Milan. location totlocali price sqfeet floor totpiani abs_price via di porta tenaglia C.A. 5+ 20000 350 5 2 piani 57.14286 corso giuseppe garibaldi 95 Pentalocale 18000 369 5 5 piani 48.78049 via della spiga 23 Bilocale 2500 55 2 4 piani 45.45455 via dei giardini C.A. 5+ 18500 415 2 6 piani 44.57831 piazza san babila C.A. Bilocale 1833 42 1 4 piani 43.64286 ottimo stato nono piano, C.A. Monolocale 2000 47 9 11 piani 42.55319 Then as a further point it might be important to investigate a linear model whose response is price and whose covariates are the newly created abs_price and some other presumably important ones e.g. floor, bagno, totpiani. The model fitted is log2(price) ~ log2(abs_price) + bagno + floor + totpiani. The plot in figure 6.5 has the purpose to demonstrate how monthly price is affected by covariates conditioned to their respective square meter footage. The interpretation of the plot starts by fixing a focus point on 0, which is the null effect highlighted by the red dashed line. Then the second focus is on house surface effect (i.e. House Surface (doubling) in the plot, the term log2(abs_price) has been converted to more familiar House Surface (doubling)), which contributes to increase the price of an estimated coefficient of \\(\\approx .6\\) for each doubling of the square meter footage. Then what it can be noticed with respect to the two focus points are the unusual effects provoked by the other predictors t the right of the house surface effect and to the far left below 0. 2 and 3 bagni are unusually expensive with respect to the square meter footage increment, on the other hand\" al piano rialzato\" and al piano terra are undervalued with respect to their surface. The fact that 2 and 3 bathrooms can guarantee a monthly extra check is probably caused to a minimum rent plateau requested for each occupant. the number of bathrooms are a proxy to both house extension since normally for each sleeping room there also exist at least 1 bathroom as well as prestigious houses dispose of more than 1 toilette services. So the more are the occupants regardless of the square meter footage dedicated to them, the more the house monthly returns, it can be noticed is that ultimo piano, otgether with 2 abagni ad 3 bagni are unusually expensive with respect to their proper square meter footage. On the other hand the piano rialzato and piano terra are unusually undervalued given their surface. In other words the to help with the interpretation. The fact that 2 and 3 bathrooms can guarantee a monthly extra check is probably caused to a minimum rent plateau requested for each occupant. So the more are the occupants regardless of the square meter footage dedicated to them, the more the house returns. The conclusion Tie fighter coefficient plot for the linear model: \\(\\log_{2}(price) \\sim \\log_{2}(abs\\_price) + condominium + other_colors\\) Figure 6.5: Tie fighter coefficient plot for the log-linear model 6.4 Text Mining in estate Review The word network in figure (fig:WordNetworkgraph) tries to summarize relevant information from real estate agency review into each advertisement. avg_totprice expresses the sum of the price per month plus the condominium in order to fulzly integrate inner property characteristics together with building exclusivity. Tokenized words are then filtered with stopwords-iso italian dictionary. Nodes associated with hotter colours are also associated to more expensive in and out-house characteristics. The size of nodes keeps track of the number of reviews in which the specific word appears. A table of the most common words can help highlight both the real estate jargon as well as words that brings up house values. word count reviews avg_totprice bagno 249 192 1888.622 cucina 247 190 2088.814 ingresso 194 173 1964.062 soggiorno 182 159 1872.500 camera 200 158 1936.945 piano 197 157 1982.234 arredato 184 152 1744.614 composto 158 146 1758.911 riscaldamento 171 144 1877.404 zona 282 139 1930.213 Furthermore it is possible to grossly divide the plot in figure (fig:WordNetworkgraph) into 3 sub-groups of nodes, each of which addresses a specific part of the house comprehensive evaluation. In the far right side of the plot are considered the external appliances like neighbor stores, subway stations and services and are associated to mean prices. The correspondent number of reviews are not justifying by any type of price increasing effect. Whereas slightly moving the view to the left, the area centered in portineria evidences a sub-groups of nodes associated to relatively higher avg-totprice. Some of them are servizio signorile palazzo. The previous set of nodes indicates services that are proper to the building can lead to some sort of extra payment. Then still moving Possiamo immaginare di dividere il network in 3 raggruppamenti di nodi, ognuno dei quali parla di uni specifico tema. nella parte alta sinistra csi parla delle circostanze estenre dellappartamente, i negozi i mezzi serizi la metri, i prezzi evidenzziati dal colore nei nodi sono neutri, indicando che non impattano il prezzo in maniera significativa. poco pi√π sotto √® possibile vedere un altro centroide verso il quale puntano una serie di edges peritenti che riguardano i servizi interni al building come la portinerua, lingresso, il palazzo. in questo caso i colori sono pi√π caldi e i servizi sembrano essere pagati di pi√π. successivamente sosptandoci veros il centro delnetwork si nota un nodo di gravit√† attorno alquale si trovamo molti outgoing edges, che riscaldamento. Attorno a riscaldamento che vista la grandezza ricorre spesso nelle recensioni, si sviluppano tutti i servizi non descritti da immobiliare allinterno della casa, insiema a tutte le caratteristiche cbe distinguono la casa revisionata dalle altre. i colori degradano spostandosi da sinistra verso destea, accanto a riscaldmaento si nota un cluster che associati a prezzi minoro come spese condominiali e arredato arredato. nel caso delle spese condominiali i cluster sono associati a prezzi minori perch√® il prezzo del conominio spesso non √® commisurato al prezzo n√® al prestigio dellappartamento. Speso infatti include costi variabili come utenze gas e luce, o acqua che vengono scontati con prezzi pi√π bassi di affitto. la somma di condominio e prezzo offrirebbe un panorama pi√π chiaro. Figure 6.6: Word Network Graph for 250 Estate Agencies Review 6.5 Missing Assessement and Imputation Some data might be lost since immobiliare provides the information that in turn are pre filled by estate agencies or privates through standard document formats. Some of the missing can be reverse engineered by other information in the web pages e.g. given the street address it is possible to trace back the lat and long coordinates. Some other information can be encountered in .json files hidden inside each of the single web pages. The approach followed in this part is to prune redundant data and rare predictors trying to limit the dimensionality of the dataset. 6.5.1 Missing assessement The first problem to assess is why information are missing. As already pointed out in the preliminary part as well as in section ?? many of the presumably important covariates (i.e. price lat, long, title ,id ) undergo to a sequence of forced step inside scraping functions with the aim to avoid to be lost. If at the end of the sequence covariates are still missing, the correspondent observation is not considered and it is left out of the resulting scraped dataset. The choice originates from empirical missing patterns suggesting that when important information are missing then the rest of the covariates are more likely to be missing to, as a consequence the observation should be discarded. The missing profile is crucial since it can also raise suspicion on the scraping failures. By Taking advantage of the missing pattern in observations the maintainer can directly identify the problem and derivatives and immediately debug the error. In order to identify if the nature of the pattern a revision of missing and randomness is introduced by Little and Rubin (2014). Missing can be devided into 3 categories: MCAR (missing completely at random) likelihood of missing is equal for all the information, in other words missing data are one idependetn for the other. MAR (missing at random) likelihood of missing is not equal. NMAR (not missing at random) data that is missing due to a specific cause, scarping can be the cause. MNAR is often the case of daily monitoring clinical studies (Kuhn and Johnson 2019), where patient might drop out the experiment because of death and so all the relating data starting from the death time +1 are lost. To identify the pattern a heat map plot 6.7 clarifies the idea: Figure 6.7: Missingness Heatmap plot Looking at the top of the heat map plot, right under the Predictor label, the first tree split divides predictors into two sub-groups. The left branch considers from TOTPIANI to CATASTINFO and there are no evident patterns. Then missingness can be traced back to MAR. Imputation needs to be applied up to CONDOM included, the others are discarded due to rarity: i.e. BUILDAGE: 14% missing, CATASTINFO: 21% and AC: 24%. Moreover CUCINA and ALTRO are generated as childred of the original LOCALI variable, so it should not surprise that their missing behavior is similar ,whose prevalence is respectively 13% and 14%, for that reason are discarded. In the far right hand side ENCLASS and DISP data are completely missing and a pattern seems to be found. The most obvious reason is a scraping fail in capturing data. Further inspection of the API scraping functions focused on the two covariates is strongly advised. From LOWRDPRICE. covariates gorup class it seems to be witnessing a missing underlining pattern NMAR which is clearer by looking at the co_occurrence plot in figure 6.8. Co-occurrence analysis might suggest frequency of missing predictor in combination and LOWRDPRICE. class covariates are displaying this type of behavior. PAUTO is missing in the place where LOWRDPRICE. class covariates are missing, but this is not happening for the opposite, leading to the conclusion that PAUTO should be treated as a rare covariate MAR, therefore PAUTO is dropped. After some further investigation on LOWRDPRICE., the group class flags when the PRICE covariate is effectively decreased and this is unusual. That is solved by grouping the covariates information and to encode it as a two levels categorical covariate if lowered or not. Further methods to feature engineer the LOWRDPRICE. class covariates can be with techniques typical of profile data, further references are on Kuhn and Johnson (2019). Figure 6.8: Missingness co-occurrence plot 6.5.2 Missing Imputation A relatively simple approach to front missingness is to build a regression model to explain the covariates that have some missing and plug-back-in the respective estimates (e.g. posterior means) from their predictive distributions Little and Rubin (2014). This approach is fast and easy to implement in most of the cases, but it ignores the uncertainty behind the imputed values (G√≥mez Rubio 2020). However it has the benefit to be a more than a reasonable choice with respect to the number of computation required, especially with INLA and in a spatial setting. That makes it the first choice method to follow since imputation regards also a small portion of data and predictors. At first it is considered the predictor condominium for which some observation are missing. Indices are: ## [1] 19 74 77 90 99 113 116 120 179 249 A model is fitted based on missing data for which the response var is condominium and predictors are other important explanatory ones, i.e.condom ~ 1 + sqfeet + totlocali + floor + heating + ascensore. In addition to the formula in the inla function a further specification has to be provided with the command compute = TRUE in the argument control.predictor. The command compute estimates the posterior means of the predictive distribution in the response variable for the missing points. The estimated posetior mean quantities are then imputeda are in table @red(tab:CondomImputation) mean sd fitted.Predictor.019 198.11095 19.67085 fitted.Predictor.074 162.96544 13.29456 fitted.Predictor.077 99.38197 32.34108 fitted.Predictor.090 331.73519 33.05035 fitted.Predictor.099 170.54068 12.30267 fitted.Predictor.113 196.61593 15.86545 fitted.Predictor.116 108.40482 20.79689 fitted.Predictor.120 162.86977 25.61622 fitted.Predictor.179 165.03632 20.53485 fitted.Predictor.249 117.24234 30.80290 References "]]
