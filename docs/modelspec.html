<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Model Selection &amp; Fitting | RESTful Scraping API for Real Estate data, a Spatial Bayesian modeling perspective with INLA</title>
  <meta name="description" content="This is Niccolò Salvini master’s thesis project" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Model Selection &amp; Fitting | RESTful Scraping API for Real Estate data, a Spatial Bayesian modeling perspective with INLA" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://niccolosalvini.github.io/Thesis/" />
  <meta property="og:image" content="https://niccolosalvini.github.io/Thesis/images/logo/spatial_logo.png" />
  <meta property="og:description" content="This is Niccolò Salvini master’s thesis project" />
  <meta name="github-repo" content="NiccoloSalvini/thesis" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Model Selection &amp; Fitting | RESTful Scraping API for Real Estate data, a Spatial Bayesian modeling perspective with INLA" />
  
  <meta name="twitter:description" content="This is Niccolò Salvini master’s thesis project" />
  <meta name="twitter:image" content="https://niccolosalvini.github.io/Thesis/images/logo/spatial_logo.png" />

<meta name="author" content="Niccolò Salvini" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="images/logo/spatial_logo.png" />
  <link rel="shortcut icon" href="images/logo/spatial_logo.ico" type="image/x-icon" />
<link rel="prev" href="exploratory.html"/>
<link rel="next" href="conclusions.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.3/leaflet.js"></script>
<link href="libs/leaflet-easybutton-1.3.1/easy-button.css" rel="stylesheet" />
<script src="libs/leaflet-easybutton-1.3.1/easy-button.js"></script>
<script src="libs/leaflet-easybutton-1.3.1/EasyButton-binding.js"></script>
<link href="libs/leaflet-locationfilter2-0.1.1/locationfilter.css" rel="stylesheet" />
<script src="libs/leaflet-locationfilter2-0.1.1/locationfilter.js"></script>
<script src="libs/leaflet-locationfilter2-0.1.1/locationfilter-bindings.js"></script>
<link href="libs/ionicons-2.0.1/ionicons.min.css" rel="stylesheet" />
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<link href="libs/leaflet-minimap-3.3.1/Control.MiniMap.min.css" rel="stylesheet" />
<script src="libs/leaflet-minimap-3.3.1/Control.MiniMap.min.js"></script>
<script src="libs/leaflet-minimap-3.3.1/Minimap-binding.js"></script>
<script src="libs/core-js-2.5.3/shim.min.js"></script>
<script src="libs/react-16.12.0/react.min.js"></script>
<script src="libs/react-16.12.0/react-dom.min.js"></script>
<script src="libs/reactwidget-1.0.0/react-tools.js"></script>
<script src="libs/reactable-binding-0.2.3/reactable.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-171723874-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-171723874-1');
</script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="./"><img src="images/logo/spatial_logo.png"></a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="scraping.html"><a href="scraping.html"><i class="fa fa-check"></i><b>2</b> Web Scraping</a><ul>
<li class="chapter" data-level="2.1" data-path="scraping.html"><a href="scraping.html#reverse"><i class="fa fa-check"></i><b>2.1</b> A Gentle Introduction on Web Scraping</a></li>
<li class="chapter" data-level="2.2" data-path="scraping.html"><a href="scraping.html#anatomy-of-a-url-and-reverse-engineering"><i class="fa fa-check"></i><b>2.2</b> Anatomy of a url and reverse engineering</a><ul>
<li class="chapter" data-level="2.2.1" data-path="scraping.html"><a href="scraping.html#scraping-with-rvest"><i class="fa fa-check"></i><b>2.2.1</b> Scraping with <code id="ContentArchitecture">rvest</code></a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="scraping.html"><a href="scraping.html#ProperScraping"><i class="fa fa-check"></i><b>2.3</b> Searching Technique for Scarping</a></li>
<li class="chapter" data-level="2.4" data-path="scraping.html"><a href="scraping.html#best-practices"><i class="fa fa-check"></i><b>2.4</b> Scraping Best Practices and Security provisions</a></li>
<li class="chapter" data-level="2.5" data-path="scraping.html"><a href="scraping.html#HTTPmethod"><i class="fa fa-check"></i><b>2.5</b> HTTP overview</a><ul>
<li class="chapter" data-level="2.5.1" data-path="scraping.html"><a href="scraping.html#spoofing"><i class="fa fa-check"></i><b>2.5.1</b> User Agent and further Identification Headers Spoofing</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="scraping.html"><a href="scraping.html#possibly"><i class="fa fa-check"></i><b>2.6</b> Dealing with failure</a></li>
<li class="chapter" data-level="2.7" data-path="scraping.html"><a href="scraping.html#parallelscraping"><i class="fa fa-check"></i><b>2.7</b> Parallel Scraping</a><ul>
<li class="chapter" data-level="2.7.1" data-path="scraping.html"><a href="scraping.html#parallel-furrrfuture"><i class="fa fa-check"></i><b>2.7.1</b> Parallel furrr+future</a></li>
<li class="chapter" data-level="2.7.2" data-path="scraping.html"><a href="scraping.html#parallel-foreachdofuture"><i class="fa fa-check"></i><b>2.7.2</b> Parallel foreach+doFuture</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="scraping.html"><a href="scraping.html#legal"><i class="fa fa-check"></i><b>2.8</b> Legal Profiles</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="Infrastructure.html"><a href="Infrastructure.html"><i class="fa fa-check"></i><b>3</b> API Technology Stack</a><ul>
<li class="chapter" data-level="3.1" data-path="Infrastructure.html"><a href="Infrastructure.html#restful-api"><i class="fa fa-check"></i><b>3.1</b> RESTful API</a><ul>
<li class="chapter" data-level="3.1.1" data-path="Infrastructure.html"><a href="Infrastructure.html#plumberapi"><i class="fa fa-check"></i><b>3.1.1</b> Plumber HTTP API</a></li>
<li class="chapter" data-level="3.1.2" data-path="Infrastructure.html"><a href="Infrastructure.html#sanitize"><i class="fa fa-check"></i><b>3.1.2</b> Sanitization</a></li>
<li class="chapter" data-level="3.1.3" data-path="Infrastructure.html"><a href="Infrastructure.html#DoS"><i class="fa fa-check"></i><b>3.1.3</b> Denial Of Service (DoS)</a></li>
<li class="chapter" data-level="3.1.4" data-path="Infrastructure.html"><a href="Infrastructure.html#logging"><i class="fa fa-check"></i><b>3.1.4</b> Logging</a></li>
<li class="chapter" data-level="3.1.5" data-path="Infrastructure.html"><a href="Infrastructure.html#docs"><i class="fa fa-check"></i><b>3.1.5</b> RESTful API docs</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="Infrastructure.html"><a href="Infrastructure.html#docker"><i class="fa fa-check"></i><b>3.2</b> Docker</a><ul>
<li class="chapter" data-level="3.2.1" data-path="Infrastructure.html"><a href="Infrastructure.html#dockerfile"><i class="fa fa-check"></i><b>3.2.1</b> REST-API container</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="Infrastructure.html"><a href="Infrastructure.html#nginx"><i class="fa fa-check"></i><b>3.3</b> NGINX reverse Proxy Server and Authorization</a></li>
<li class="chapter" data-level="3.4" data-path="Infrastructure.html"><a href="Infrastructure.html#docker-compose"><i class="fa fa-check"></i><b>3.4</b> Docker-Compose</a></li>
<li class="chapter" data-level="3.5" data-path="Infrastructure.html"><a href="Infrastructure.html#HTTPS"><i class="fa fa-check"></i><b>3.5</b> HTTPS(ecure) and SSL certificates</a></li>
<li class="chapter" data-level="3.6" data-path="Infrastructure.html"><a href="Infrastructure.html#aws"><i class="fa fa-check"></i><b>3.6</b> AWS EC2 instance</a></li>
<li class="chapter" data-level="3.7" data-path="Infrastructure.html"><a href="Infrastructure.html#sdwf"><i class="fa fa-check"></i><b>3.7</b> Software CI/CD Workflow</a></li>
<li class="chapter" data-level="3.8" data-path="Infrastructure.html"><a href="Infrastructure.html#further-sf-integrations"><i class="fa fa-check"></i><b>3.8</b> Further SF Integrations</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="inla.html"><a href="inla.html"><i class="fa fa-check"></i><b>4</b> INLA</a><ul>
<li class="chapter" data-level="4.1" data-path="inla.html"><a href="inla.html#LGM"><i class="fa fa-check"></i><b>4.1</b> The class of Latent Gaussian Models (LGM)</a></li>
<li class="chapter" data-level="4.2" data-path="inla.html"><a href="inla.html#gmrf"><i class="fa fa-check"></i><b>4.2</b> Gaussian Markov Random Field (GMRF)</a></li>
<li class="chapter" data-level="4.3" data-path="inla.html"><a href="inla.html#approx"><i class="fa fa-check"></i><b>4.3</b> INLA Laplace Approximations</a></li>
<li class="chapter" data-level="4.4" data-path="inla.html"><a href="inla.html#rinla"><i class="fa fa-check"></i><b>4.4</b> R-INLA package</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="prdm.html"><a href="prdm.html"><i class="fa fa-check"></i><b>5</b> Geostatistical Data analysis</a><ul>
<li class="chapter" data-level="5.1" data-path="prdm.html"><a href="prdm.html#GP"><i class="fa fa-check"></i><b>5.1</b> Gaussian Process (GP)</a></li>
<li class="chapter" data-level="5.2" data-path="prdm.html"><a href="prdm.html#spdeapproach"><i class="fa fa-check"></i><b>5.2</b> The Stochastic Partial Differential Equation (SPDE) approach</a></li>
<li class="chapter" data-level="5.3" data-path="prdm.html"><a href="prdm.html#hedonic-rental-price-models"><i class="fa fa-check"></i><b>5.3</b> Hedonic (rental) Price Models</a></li>
<li class="chapter" data-level="5.4" data-path="prdm.html"><a href="prdm.html#criticism"><i class="fa fa-check"></i><b>5.4</b> Model Criticism</a><ul>
<li class="chapter" data-level="5.4.1" data-path="prdm.html"><a href="prdm.html#predbase"><i class="fa fa-check"></i><b>5.4.1</b> Methods based on the predictive distribution</a></li>
<li class="chapter" data-level="5.4.2" data-path="prdm.html"><a href="prdm.html#deviance-based-criteria"><i class="fa fa-check"></i><b>5.4.2</b> Deviance-based Criteria</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="prdm.html"><a href="prdm.html#priorsspec"><i class="fa fa-check"></i><b>5.5</b> Penalized Complexity Priors</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="exploratory.html"><a href="exploratory.html"><i class="fa fa-check"></i><b>6</b> Exploratory Analysis</a><ul>
<li class="chapter" data-level="6.1" data-path="exploratory.html"><a href="exploratory.html#prep"><i class="fa fa-check"></i><b>6.1</b> Preprocessing and Feature Engineering</a></li>
<li class="chapter" data-level="6.2" data-path="exploratory.html"><a href="exploratory.html#spatassess"><i class="fa fa-check"></i><b>6.2</b> Spatial Dependece Assessement</a></li>
<li class="chapter" data-level="6.3" data-path="exploratory.html"><a href="exploratory.html#factor-counts"><i class="fa fa-check"></i><b>6.3</b> Factor Counts</a></li>
<li class="chapter" data-level="6.4" data-path="exploratory.html"><a href="exploratory.html#assessing-the-most-valuable-properties"><i class="fa fa-check"></i><b>6.4</b> Assessing the most valuable properties</a></li>
<li class="chapter" data-level="6.5" data-path="exploratory.html"><a href="exploratory.html#assessing-relevant-predictors"><i class="fa fa-check"></i><b>6.5</b> Assessing relevant predictors</a></li>
<li class="chapter" data-level="6.6" data-path="exploratory.html"><a href="exploratory.html#missassimp"><i class="fa fa-check"></i><b>6.6</b> Missing Assessement and Imputation</a><ul>
<li class="chapter" data-level="6.6.1" data-path="exploratory.html"><a href="exploratory.html#missing-assessement"><i class="fa fa-check"></i><b>6.6.1</b> Missing assessement</a></li>
<li class="chapter" data-level="6.6.2" data-path="exploratory.html"><a href="exploratory.html#missing-imputation"><i class="fa fa-check"></i><b>6.6.2</b> Missing Imputation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="modelspec.html"><a href="modelspec.html"><i class="fa fa-check"></i><b>7</b> Model Selection &amp; Fitting</a><ul>
<li class="chapter" data-level="7.1" data-path="modelspec.html"><a href="modelspec.html#modelspecandmesh"><i class="fa fa-check"></i><b>7.1</b> Model Specification &amp; Mesh Assessement</a></li>
<li class="chapter" data-level="7.2" data-path="modelspec.html"><a href="modelspec.html#spdemodeol"><i class="fa fa-check"></i><b>7.2</b> Building the SPDE model</a></li>
<li class="chapter" data-level="7.3" data-path="modelspec.html"><a href="modelspec.html#fit"><i class="fa fa-check"></i><b>7.3</b> Model Fitting and Results</a></li>
<li class="chapter" data-level="7.4" data-path="modelspec.html"><a href="modelspec.html#spatial-prediction-on-grid"><i class="fa fa-check"></i><b>7.4</b> Spatial Prediction on grid</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="conclusions.html"><a href="conclusions.html"><i class="fa fa-check"></i><b>8</b> Conclusions</a></li>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i>Appendix</a><ul>
<li class="chapter" data-level="8.1" data-path="appendix.html"><a href="appendix.html#triangular"><i class="fa fa-check"></i><b>8.1</b> SPDE and Triangularization (YT speech: <span class="citation">Moraga (<span>2020</span>)</span>)</a></li>
<li class="chapter" data-level="8.2" data-path="appendix.html"><a href="appendix.html#laplaceapprox"><i class="fa fa-check"></i><b>8.2</b> Laplace Approximation</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/NiccoloSalvini/tesi-prova" target="blank"> See Github Repository</a></li>
<li><a href="https://niccolosalvini.netlify.app/">About The Author</a></li>
<li><a Proudly published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">RESTful Scraping API for Real Estate data, a Spatial Bayesian modeling perspective with INLA</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="modelspec" class="section level1">
<h1><span class="header-section-number">Chapter 7</span> Model Selection &amp; Fitting</h1>
<p>In this chapter is applied all the theory seen so far through the R-INLA package. The hierarchical Latent Gaussian model to-be-fitted sets against the response price (inevitably normalized) with the other predictors scraped (standardized and scaled the numerical ones). As a result on top of the hierarchy i.e. the higher level the model places the likelihood of data for which a Normal distribution is specified. At the medium level the GMRF containing the latent components and distributed as a Multivariate Normal (centered in zero and with “markov” precision matrix). In the end penalized complexity priors are specified as prior distributions. The SPDE approach trinagularize the spatial domain and makes possible to pass from a discrete surface to a continuous representation of the own process. This requires a series of steps ranging from mesh building, passing the mesh inside the Matérn obtaining the spde object and then reprojecting through the stack function. In the end the model is fitted integrating the spatial random field and posterior distributions for parameters and hyper parameters are evaluated.</p>
<!-- # ```{r covariasel, eval=F} -->
<!-- # resp = "price" -->
<!-- # covar = final_data %>%  names() -->
<!-- # # Specify the formula -->
<!-- # formula_lin <- as.formula(paste0(resp, " ~ ", # Response first -->
<!-- #                           paste(covar, collapse = " + ") # Collapse the vector of covariates -->
<!-- # )) -->
<!-- #  -->
<!-- # IM0.1  <- inla(formula_lin,  -->
<!-- #                family = "nbinomial", # Specify the family. Can be a wide range (see r-inla.org). -->
<!-- #                data = TestHosts) # Specify the data -->
<!-- #  -->
<!-- # # Then with an ID random effect #### -->
<!-- #  -->
<!-- # f0.2 <- as.formula(paste0(resp, " ~ ",  -->
<!-- #                           paste(covar, collapse = " + "),  -->
<!-- #                           " +  f(ID, model = 'iid')")) # This is how you include  a typical random effect. -->
<!-- #  -->
<!-- # IM0.2  <- inla(f0.2,  -->
<!-- #                family = "nbinomial", -->
<!-- #                data = TestHosts)  -->
<!-- #  -->
<!-- # summary(IM0.1) -->
<!-- # summary(IM0.2) -->
<!-- #  -->
<!-- # ``` -->
<!--                                                  [var selection](https://ourcodingclub.github.io/tutorials/inla/) -->
<div id="modelspecandmesh" class="section level2">
<h2><span class="header-section-number">7.1</span> Model Specification &amp; Mesh Assessement</h2>
<p>In order to make the distribution of the response i.e. price (per month in €) approximately Normal it is applied a <span class="math inline">\(log_{10}\)</span> transformation (further transformation would have better Normalized data i.e. Box-Cox <span class="citation">(Box and Cox <a href="#ref-boxcox" role="doc-biblioref">1964</a>)</span> and Yeo-Johnson <span class="citation">(Yeo and Johnson <a href="#ref-yeojohnson" role="doc-biblioref">2000</a>)</span> however they over complicate interpretability). Moreover all of the numerical covariate i.e. condominium, and sqmeeter, (respectively the condominium price and the house width) are standardized and scale for modeling purposes. No assessement neither validation set are retained since it is going to be fitted a LOOCV (refer to <a href="prdm.html#criticism">5.4</a>) throughout the <code>inla()</code> function call. The Locations are represented in map plot <a href="modelspec.html#fig:ggmap">7.1</a> within the borders of the Municipality of Milan. At first the borders shapefile is imported from <a href="https://geoportale.comune.milano.it/sit/open-data/">GeoPortale Milano</a>. The corresponding CRS is in UTM (i.e. Eastings and Northings) which differs from the spatial covariates extracted (lat and long). Therefore the spatial entity needs to be moved from UTM to latlong reprojected to a new CRS. In the end the latitude and the longitude points are overlayed to the borders as in figure <a href="modelspec.html#fig:ggmap">7.1</a>.</p>
<div class="figure"><span id="fig:ggmap"></span>
<img src="07-model_fitting_files/figure-html/ggmap-1.png" alt="Milan Real Estate data within the Municpality borders, 4 points of interest, author's source" width="672" />
<p class="caption">
Figure 7.1: Milan Real Estate data within the Municpality borders, 4 points of interest, author’s source
</p>
</div>
<p>The hierarchical model defined for Milan Real Estate Rental data, for which it is assumed Normality is:</p>
<p><span class="math display">\[
{y}_{i} \sim \operatorname{Normal}\left(\eta_{i}, \sigma_{e}^{2}\right)
\]</span>
And the linear predictor i.e. mean since the <span class="math inline">\(\mathrm{g}\left(\mu_{i}\right)\)</span> is identity, is:</p>
<p><span class="math display">\[
\eta_{i}=b_{0}+x_{i} \boldsymbol\beta+\xi_{i} 
\]</span>
where, following the expression <a href="inla.html#eq:linearpredictor">(4.1)</a> in chapter <a href="inla.html#inla">4</a>, <span class="math inline">\(\xi_i\)</span> is the spatial random effect for the function <span class="math inline">\(f_1()\)</span>, for the set of coviarates <span class="math inline">\(\boldsymbol{z}=\left(x_{1} = lat,\, x_{2} = long\right)\)</span>. <span class="math inline">\(\xi_{i}\)</span> is also the GMRF seen in chapter <a href="inla.html#gmrf">4.2</a> which is distributed as a multivariate Normal and whose covariance function is Matérn (fig. <a href="#fig:matern">5.4</a>) i.e. <span class="math inline">\(\xi_{i} \sim N\left(\mathbf{0}, \mathbf{Q}_{\mathscr{C}}^{-1}\right)\)</span>. The precision matrix <span class="math inline">\(\mathbf{Q}_{\mathscr{C}}^{-1}\)</span> (see left panel in figure <a href="inla.html#fig:precisionmat">4.1</a>) is the one that requires to be treated with SPDE and its dimensions are <span class="math inline">\(n \times n\)</span>, in this case when NA are omitted is <span class="math inline">\(192 \times 192\)</span>.
<span class="math inline">\(\boldsymbol\beta\)</span> are the model scraped covariates, which include condom, totlocali, altro, bagno, cucina, heating, photosnum, floor, price, sqfeet, fibra_ottica, videocitofono, impianto_di_allarme, reception, porta_blindata, esposizione_esterna, cancello_elettrico, portiere_intera_giornata, balcone, arredato, impianto_tv_centralizzato, armadio_a_muro, portiere_mezza_giornata, caminetto, esposizione_interna, mansarda, parzialmente_arredato, taverna, idromassaggio, terrazza, esposizione_doppia, giardino_comune, giardino_privato.</p>
<p>Moreover the latent field which is <em>a priori</em> independent is <span class="math inline">\(\boldsymbol{\theta}=\{\boldsymbol{\xi}, \boldsymbol{\beta}\}\)</span>.
Then in the end the model can be reformualted as follows:</p>
<p><span class="math display">\[
\boldsymbol{\mathbf{y}}=\boldsymbol{z} \boldsymbol{\beta}+\boldsymbol{\xi}+\boldsymbol{\varepsilon}, \quad \boldsymbol{\varepsilon} \sim N\left(\mathbf{0}, \sigma_{\varepsilon}^{2} I_{d}\right)
\]</span>
The first step needed to fit the model through SPDE approach is to triangulate the domain space as intuited in <a href="prdm.html#spdeapproach">5.2</a>. The function <code>inla.mesh.2d</code> together with the <code>inla.nonconvex.hull</code> are able to define a good triangulation since no original boundaries are provided. Two meshes are produced, whose figure are in <a href="modelspec.html#fig:meshes">7.2</a>. Triangles appears to be equilateral and smooth, which suggest a decent interpolation <em>miss lit</em>. Critical parameters for meshes are <code>max.edge=c(0.025, 0.048)</code> and <code>max.edge=c(0.017, 0.019)</code> which also regulates the refinement. Further trials have show that below the limit max.edge value of <span class="math inline">\(0.017\)</span> the current machine does not output the result due to heavy calculations, therefore the maximum number of vertices obtainable coincides with the triangulation built in mesh_2.</p>
<div class="figure"><span id="fig:meshes"></span>
<img src="07-model_fitting_files/figure-html/meshes-1.png" alt="Left: mesh traingulation for 156 vertices, Right: mesh traingulation for 324 vertices" width="672" />
<p class="caption">
Figure 7.2: Left: mesh traingulation for 156 vertices, Right: mesh traingulation for 324 vertices
</p>
</div>
<p>At this point with the aim to apply INLA and specify the SPDE object are needed to be assigned both priors and hyper priors. The latent field <span class="math inline">\(\boldsymbol\theta\)</span> requires to have Gaussian vagues ones with a fixed precision. The priors <span class="math inline">\(\boldsymbol\psi_1\)</span> for the higher level eq. <a href="inla.html#eq:higher">(4.3)</a> are <span class="math inline">\(\boldsymbol\psi_1 = \left(\sigma_{\mathscr{C}}^{2}, \kappa\right)\)</span> i.e. hyper parameter for the GMRF latent field precision and Matérn are chosen to be PC priors <a href="prdm.html#priorsspec">5.5</a> [… qualcosa di più su pc prior choice …]. At the medium level it is needed a further hyper prior <span class="math inline">\(\boldsymbol\psi_2 = (\sigma_{\varepsilon}^{2})\)</span> which accounts for the variance of the <span class="math inline">\(\boldsymbol{y}\)</span> data.</p>
<!-- $$ -->
<!-- \begin{tabular}[t]{lcc} -->
<!-- Treatment A&Treatment A\\ -->
<!-- \hline -->
<!-- \text{for precision of Surface} \sigma_{e}^{2}  & (1, 0.5)\\ -->
<!-- \text{Mean of spatial} range \kappa&--(20, 0.8)\\ -->
<!-- \text{for precision spatial effect} \sigma_{\mathscr{C}}^{2}& (0.4, 0.2)\\ -->
<!-- \hline -->
<!-- \end{tabular} -->
<!-- $$ -->
<p>Thus following the equation in <a href="inla.html#eq:formallgm">(4.5)</a> then it is obtained:</p>
<p><span class="math display">\[
\pi(\boldsymbol{\theta}, \boldsymbol{\psi} \mid \mathbf{y})\propto  \underbrace{\pi(\boldsymbol{\psi})}_{\text {priors}} \times \underbrace{\pi(\boldsymbol\theta \mid \boldsymbol\psi)}_{\text {GMRF}} \times \underbrace{\prod_{i=1}^{\mathbf{I}} \pi\left(\mathbf{y} \mid \boldsymbol\theta, \boldsymbol{\psi}\right)}_{\text {likelihood }}
\]</span></p>
</div>
<div id="spdemodeol" class="section level2">
<h2><span class="header-section-number">7.2</span> Building the SPDE model</h2>
<p>The SPDE model object is built with the function <code>inla.spde2.pcmatern()</code> which needs as arguments the mesh triangulation and the PC priors <a href="prdm.html#priorsspec">5.5</a>, satisfying the following probability statements: <code>prior.range = c(r, alpha_r)</code> for <span class="math inline">\(\operatorname{Prob}(\rho&lt;r)&lt;\alpha_{r}\)</span> where <span class="math inline">\(\rho\)</span> is the spatial range of the random field. And <code>prior.sigma = c(s, alpha_s)</code> for <span class="math inline">\(\operatorname{Prob}(\sigma&gt;s)&lt;\alpha_{s}\)</span> where <span class="math inline">\(\sigma\)</span> is the marginal standard deviation of the field [… trova le relazione con variogram (ci metto dentro l’empirical range e una standard deviation abbastanza grande)…] <a href="exploratory.html#spatassess">6.2</a>.
As model complexity increases, for instance, a lot of random effects are found in the linear predictor and chances are that SPDE object may get into trouble. As a result the <code>inla.stack</code> function recreates the linear predictor as a combination of the elements of the old linear predictor and a the matrix of observations A. Further mathematical details about the stack are in <span class="citation">Blangiardo (<a href="#ref-Blangiardo-Cameletti" role="doc-biblioref">2015</a>)</span>, but are beyond the scope of the analysis.</p>
</div>
<div id="fit" class="section level2">
<h2><span class="header-section-number">7.3</span> Model Fitting and Results</h2>
<p>In the end the model is fitted whose final formula is <span class="math inline">\(\log_{10}(price) \sim Intercept + totlocali + \dots + f(coordinate, model = spde1)\)</span>. The most part of the covariates are omitted for brevity reasons. It is only considered the spatial effect for the <code>f()</code> in which needs to reside also both the coordinates and the spde object.</p>
<!-- PROVARE A FAR FUNZIONARE INLABRU -->
<p>With regard to model criticsm, the model evaluation is focused on DIC and CPO, which are directly obtained from the output of the R-INLA object.</p>
<p>inference on posterior results, credibility levels</p>
<p>posterior results table…</p>
</div>
<div id="spatial-prediction-on-grid" class="section level2">
<h2><span class="header-section-number">7.4</span> Spatial Prediction on grid</h2>
<p>A gridded object is required in order to project spatial prediction on the domain space. Usually these operations are very computationally expensive since grid objects size can easily reach <span class="math inline">\(10^4\)</span> to <span class="math inline">\(10^6\)</span> dimension points. Since in this case the linear predictor marginal distributions are not the focus then a more feasible solution consists in projecting the latent field estimated at the triangulation vertices onto the grid location <span class="citation">(<a href="#ref-Blangiardo-Cameletti" role="doc-biblioref">2015</a>)</span>. At first a proper projection matrix is created without specifying the locations.</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-Blangiardo-Cameletti">
<p>Blangiardo, Michela, Marta; Cameletti. 2015. <em>Spatial and Spatio-Temporal Bayesian Models with R-Inla</em>. Wiley.</p>
</div>
<div id="ref-boxcox">
<p>Box, G. E. P., and D. R. Cox. 1964. “An Analysis of Transformations.” <em>Journal of the Royal Statistical Society. Series B (Methodological)</em> 26 (2): 211–52. <a href="http://www.jstor.org/stable/2984418">http://www.jstor.org/stable/2984418</a>.</p>
</div>
<div id="ref-yeojohnson">
<p>Yeo, In-Kwon, and Richard Johnson. 2000. “A New Family of Power Transformations to Improve Normality or Symmetry.” <em>Biometrika</em> 87 (December). <a href="https://doi.org/10.1093/biomet/87.4.954">https://doi.org/10.1093/biomet/87.4.954</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="exploratory.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="conclusions.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": true,
"weibo": false,
"instapaper": false,
"vk": false,
"all": false,
"google": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/NiccoloSalvini/thesis/edit/master/07-model_fitting.Rmd",
"text": "Suggest an edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Niccolo_Salvini_Thesis.pdf"],
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"search": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
